<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wave Portal — Admin Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg: #0f1115;
            --glass-weak: rgba(255,255,255,0.02);
            --glass: rgba(255,255,255,0.04);
            --glass-strong: rgba(255,255,255,0.06);
            --muted: rgba(255,255,255,0.65);
            --accent: #00d4ff;
            --accent-2: #6a5cff;
            --accent-soft: rgba(0,212,255,0.08);
            --success: #28c76f;
            --warning: #ffb020;
            --danger: #ff6b6b;
            --card-radius: 14px;
            --glass-border: rgba(255,255,255,0.06);
            font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, "Helvetica Neue", Arial;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            background: radial-gradient(1200px 600px at 10% 10%, rgba(106,92,255,0.04), transparent 8%),
                        radial-gradient(800px 500px at 90% 80%, rgba(0,212,255,0.02), transparent 10%),
                        var(--bg);
            color: #e9eef8;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            overflow-x: hidden;
        }

        .wrap {
            display: flex;
            min-height: 100vh;
            gap: 28px;
            padding: 28px;
        }

        .sidebar {
            width: 260px;
            background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
            border: 1px solid var(--glass-border);
            border-radius: 18px;
            padding: 20px;
            backdrop-filter: blur(8px) saturate(120%);
            display: flex;
            flex-direction: column;
            gap: 14px;
            align-items: stretch;
            box-shadow: 0 8px 30px rgba(2,6,23,0.6) inset;
            transition: all 0.3s ease;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 10px;
        }

        .brand .logo {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent), var(--accent-2));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: #041025;
            box-shadow: 0 6px 18px rgba(106,92,255,0.12);
            overflow: hidden;
        }

        .brand .logo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .brand h2 {
            font-size: 18px;
            margin: 0;
            color: #fff;
            font-weight: 600;
        }

        .nav {
            display: flex;
            flex-direction: column;
            margin-top: 8px;
            gap: 8px;
        }

        .nav button {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 14px;
            border-radius: 12px;
            border: none;
            background: transparent;
            color: var(--muted);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 14px;
            position: relative;
            overflow: hidden;
        }

        .nav button i {
            width: 18px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .nav button:hover {
            color: #fff;
            transform: translateX(6px);
            background: linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
            box-shadow: 0 8px 30px rgba(0,0,0,0.35);
        }

        .nav button:hover i {
            transform: scale(1.2);
            color: var(--accent);
        }

        .nav button.active {
            background: linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
            color: #fff;
            box-shadow: 0 8px 30px rgba(0,0,0,0.35);
        }

        .nav button.active i {
            color: var(--accent);
            text-shadow: 0 0 10px var(--accent);
        }

        .nav button::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s ease;
        }

        .nav button:hover::after {
            left: 100%;
        }

        .sidebar .footer {
            margin-top: auto;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .logout {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px;
            border-radius: 12px;
            background: linear-gradient(90deg, var(--accent-soft), var(--accent-2));
            border: none;
            color: #e9f6ff;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(106,92,255,0.2);
        }

        .logout:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(106,92,255,0.4);
        }

        .main {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 18px;
        }

        header.main-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 18px;
            padding: 10px 0;
        }

        .title {
            display: flex;
            flex-direction: column;
        }

        .title h1 {
            margin: 0;
            font-size: 24px;
            color: #eaf6ff;
            font-weight: 700;
            text-shadow: 0 0 10px rgba(0,212,255,0.3);
        }

        .title p {
            margin: 0;
            color: var(--muted);
            font-size: 14px;
        }

        .top-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .profile-switcher {
            position: relative;
            display: inline-block;
        }

        .profile-switcher-btn {
            background: linear-gradient(90deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
            border: 1px solid rgba(255,255,255,0.06);
            padding: 10px 14px;
            border-radius: 10px;
            color: var(--muted);
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .profile-switcher-btn:hover {
            color: #fff;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.4);
            border-color: rgba(0,212,255,0.3);
        }

        .profile-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 8px;
            background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
            border: 1px solid rgba(255,255,255,0.06);
            border-radius: 12px;
            padding: 8px;
            min-width: 200px;
            box-shadow: 0 10px 30px rgba(2,6,23,0.6);
            backdrop-filter: blur(8px) saturate(120%);
            z-index: 1000;
            display: none;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .profile-dropdown.show {
            display: block;
        }

        .profile-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 14px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--muted);
        }

        .profile-option:hover {
            background: linear-gradient(90deg, rgba(0,212,255,0.08), rgba(106,92,255,0.04));
            color: #fff;
            transform: translateX(5px);
        }

        .profile-option.active {
            background: linear-gradient(90deg, rgba(0,212,255,0.12), rgba(106,92,255,0.06));
            color: #fff;
        }

        .profile-option i {
            width: 16px;
            text-align: center;
        }

        .cards {
            display: flex;
            gap: 14px;
            justify-content: center;
            flex-wrap: wrap;
            padding: 18px 0;
        }

        .card {
            min-width: 200px;
            width: 1fr;
            flex: 1 1 260px;
            max-width: 320px;
            background: linear-gradient(180deg, rgba(255,255,255,0.018), rgba(255,255,255,0.01));
            border-radius: var(--card-radius);
            padding: 20px;
            border: 1px solid var(--glass-border);
            box-shadow: 0 6px 26px rgba(2,6,23,0.6);
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 8px;
            transition: all 0.3s ease;
            backdrop-filter: blur(6px) saturate(120%);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(0,212,255,0.05), rgba(106,92,255,0.05));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .card:hover::before {
            opacity: 1;
        }

        .card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 18px 50px rgba(0,0,0,0.55), 0 0 20px rgba(0,212,255,0.1);
            border-color: rgba(0,212,255,0.2);
        }

        .card .k {
            font-size: 32px;
            font-weight: 700;
            color: #fff;
            text-shadow: 0 0 10px rgba(0,212,255,0.5);
        }

        .card .t {
            font-size: 14px;
            color: var(--muted);
        }

        .panel-wrap {
            background: linear-gradient(180deg, rgba(255,255,255,0.012), rgba(255,255,255,0.008));
            border-radius: 16px;
            padding: 20px;
            border: 1px solid var(--glass-border);
            min-height: 420px;
            box-shadow: 0 12px 40px rgba(2,6,23,0.6);
            transition: all 0.3s ease;
        }

        .panel-wrap:hover {
            box-shadow: 0 15px 50px rgba(2,6,23,0.8);
        }

        .panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
            margin-bottom: 16px;
        }

        .panel-header h3 {
            margin: 0;
            color: #fff;
            font-size: 18px;
            font-weight: 600;
        }

        .controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .table-shell {
            background: linear-gradient(180deg, rgba(255,255,255,0.006), rgba(255,255,255,0.004));
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.03);
            transition: all 0.3s ease;
        }

        .table-shell:hover {
            border-color: rgba(255,255,255,0.05);
        }

        .table-tools {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }

        .search {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .search input {
            background: transparent;
            border: 1px solid rgba(255,255,255,0.04);
            padding: 10px 14px;
            border-radius: 10px;
            color: #dfefff;
            min-width: 220px;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .search input:focus {
            outline: none;
            border-color: rgba(0,212,255,0.3);
            box-shadow: 0 0 10px rgba(0,212,255,0.1);
        }

        .select-page {
            background: transparent;
            border: 1px solid rgba(255,255,255,0.04);
            padding: 10px;
            border-radius: 10px;
            color: #dfefff;
            transition: all 0.3s ease;
        }

        .select-page:focus {
            outline: none;
            border-color: rgba(0,212,255,0.3);
        }

        table.app-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 720px;
        }

        table.app-table thead th {
            font-weight: 600;
            padding: 14px 12px;
            background: linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
            border-bottom: 1px solid rgba(255,255,255,0.03);
            color: #cfefff;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        table.app-table thead th:hover {
            background: linear-gradient(90deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
            color: #fff;
        }

        table.app-table thead th i {
            margin-right: 6px;
            transition: all 0.3s ease;
        }

        table.app-table thead th:hover i {
            color: var(--accent);
        }

        table.app-table tbody td {
            padding: 14px 12px;
            border-bottom: 1px solid rgba(255,255,255,0.02);
            color: #dbeeff;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        table.app-table tbody tr {
            transition: all 0.3s ease;
        }

        table.app-table tbody tr:hover {
            background: linear-gradient(90deg, rgba(0,212,255,0.02), rgba(106,92,255,0.02));
            transform: translateX(6px) scale(1.01);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .badge {
            padding: 6px 12px;
            border-radius: 999px;
            font-weight: 700;
            font-size: 12px;
            color: #041025;
            transition: all 0.3s ease;
        }

        .badge:hover {
            transform: scale(1.05);
        }

        .badge.live {
            background: linear-gradient(90deg, var(--accent), var(--accent-2));
            box-shadow: 0 4px 10px rgba(0,212,255,0.3);
        }

        .badge.pending {
            background: var(--warning);
            color: #0b0b0b;
            box-shadow: 0 4px 10px rgba(255,176,32,0.3);
        }

        .badge.completed {
            background: var(--success);
            color: #02210a;
            box-shadow: 0 4px 10px rgba(40,199,111,0.3);
        }

        .badge.blocked {
            background: var(--danger);
            color: #fff;
            box-shadow: 0 4px 10px rgba(255,107,107,0.3);
        }

        .btn {
            padding: 10px 14px;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            font-size: 14px;
            position: relative;
            overflow: hidden;
        }

        .btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s ease;
        }

        .btn:hover::after {
            left: 100%;
        }

        .btn i {
            width: 14px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .btn:hover i {
            transform: scale(1.2);
        }

        .btn.edit {
            background: linear-gradient(90deg, rgba(0,212,255,0.14), rgba(106,92,255,0.06));
            color: var(--accent);
            box-shadow: 0 6px 18px rgba(0,212,255,0.04);
        }

        .btn.edit:hover {
            background: linear-gradient(90deg, rgba(0,212,255,0.2), rgba(106,92,255,0.1));
            color: #fff;
            box-shadow: 0 8px 25px rgba(0,212,255,0.2);
            transform: translateY(-3px);
        }

        .btn.del {
            background: linear-gradient(90deg, rgba(255,107,107,0.08), rgba(255,107,107,0.03));
            color: var(--danger);
        }

        .btn.del:hover {
            background: linear-gradient(90deg, rgba(255,107,107,0.15), rgba(255,107,107,0.08));
            color: #fff;
            box-shadow: 0 8px 25px rgba(255,107,107,0.2);
            transform: translateY(-3px);
        }

        .btn.admin {
            background: linear-gradient(90deg, rgba(40,199,111,0.12), rgba(40,199,111,0.04));
            color: var(--success);
        }

        .btn.admin:hover {
            background: linear-gradient(90deg, rgba(40,199,111,0.2), rgba(40,199,111,0.1));
            color: #fff;
            box-shadow: 0 8px 25px rgba(40,199,111,0.2);
            transform: translateY(-3px);
        }

        .btn.member {
            background: linear-gradient(90deg, rgba(255,176,32,0.12), rgba(255,176,32,0.04));
            color: var(--warning);
        }

        .btn.member:hover {
            background: linear-gradient(90deg, rgba(255,176,32,0.2), rgba(255,176,32,0.1));
            color: #fff;
            box-shadow: 0 8px 25px rgba(255,176,32,0.2);
            transform: translateY(-3px);
        }

        .btn.view {
            background: linear-gradient(90deg, rgba(106,92,255,0.12), rgba(106,92,255,0.04));
            color: var(--accent-2);
        }

        .btn.view:hover {
            background: linear-gradient(90deg, rgba(106,92,255,0.2), rgba(106,92,255,0.1));
            color: #fff;
            box-shadow: 0 8px 25px rgba(106,92,255,0.2);
            transform: translateY(-3px);
        }

        .btn.copy {
            padding: 10px 14px;
            border-radius: 10px;
            border: none;
            background: linear-gradient(90deg, var(--accent-soft), rgba(106,92,255,0.06));
            color: #e9fbff;
            font-weight: 700;
            box-shadow: 0 6px 24px rgba(0,212,255,0.06);
        }

        .btn.copy:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 34px rgba(0,212,255,0.08);
        }

        .btn.copy.copied {
            background: linear-gradient(90deg, var(--success), rgba(40,199,111,0.06));
            box-shadow: 0 8px 34px rgba(40,199,111,0.08);
        }

        .btn.regen {
            padding: 10px 14px;
            border-radius: 10px;
            border: none;
            background: transparent;
            color: var(--muted);
            font-weight: 700;
            transition: all 0.3s ease;
        }

        .btn.regen:hover {
            color: #fff;
            transform: rotate(180deg);
            background: rgba(0,212,255,0.1);
        }

        .add-prominent {
            background: linear-gradient(90deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
            border: 1px solid rgba(255,255,255,0.06);
            padding: 12px 16px;
            border-radius: 12px;
            color: #eaf6ff;
            font-weight: 800;
            box-shadow: 0 10px 30px rgba(12,18,28,0.6);
            backdrop-filter: blur(8px) saturate(120%);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .add-prominent:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(12,18,28,0.8), 0 0 20px rgba(0,212,255,0.2);
            border-color: rgba(0,212,255,0.3);
        }

        .add-prominent i {
            margin-right: 8px;
            transition: all 0.3s ease;
        }

        .add-prominent:hover i {
            transform: scale(1.2);
            color: var(--accent);
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .avatar:hover {
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(0,212,255,0.5);
        }

        .avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .pagination {
            display: flex;
            gap: 6px;
            align-items: center;
            justify-content: flex-end;
            margin-top: 15px;
        }

        .page-btn {
            padding: 8px 12px;
            border-radius: 8px;
            background: transparent;
            border: 1px solid rgba(255,255,255,0.03);
            color: var(--muted);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .page-btn:hover {
            background: linear-gradient(90deg, rgba(0,212,255,0.06), rgba(106,92,255,0.04));
            color: #fff;
            transform: translateY(-2px);
        }

        .page-btn.active {
            background: linear-gradient(90deg, rgba(0,212,255,0.06), rgba(106,92,255,0.04));
            color: #fff;
            box-shadow: 0 4px 10px rgba(0,212,255,0.2);
        }

        .refer-box {
            display: flex;
            gap: 12px;
            align-items: center;
            background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.008));
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.03);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .refer-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(0,212,255,0.05), rgba(106,92,255,0.05));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .refer-box:hover::before {
            opacity: 1;
        }

        .refer-box:hover {
            border-color: rgba(255,255,255,0.05);
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.4);
        }

        .refer-code {
            padding: 12px 18px;
            border-radius: 12px;
            background: linear-gradient(90deg, rgba(0,212,255,0.04), rgba(106,92,255,0.04));
            font-weight: 800;
            color: #041025;
            letter-spacing: 2px;
            transition: all 0.3s ease;
            font-size: 16px;
            text-shadow: 0 0 5px rgba(0,212,255,0.3);
            box-shadow: 0 4px 15px rgba(0,212,255,0.1);
        }

        .refer-box:hover .refer-code {
            box-shadow: 0 0 15px rgba(0,212,255,0.3);
            transform: scale(1.05);
        }

        .modal-backdrop {
            position: fixed;
            inset: 0;
            display: none;
            align-items: center;
            justify-content: center;
            background: linear-gradient(rgba(2,6,23,0.7), rgba(2,6,23,0.7));
            z-index: 1200;
            animation: fadeIn 0.3s ease;
        }

        .modal-card {
            width: 520px;
            background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.03);
            box-shadow: 0 12px 40px rgba(2,6,23,0.6);
            animation: scaleIn 0.3s ease;
            max-height: 90vh;
            overflow-y: auto;
        }

        @keyframes scaleIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .modal-row {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-top: 12px;
        }

        .modal-row input, .modal-row select, .modal-row textarea {
            flex: 1;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.04);
            background: transparent;
            color: #dfefff;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .modal-row input:focus, .modal-row select:focus, .modal-row textarea:focus {
            outline: none;
            border-color: rgba(0,212,255,0.3);
            box-shadow: 0 0 10px rgba(0,212,255,0.1);
        }

        .modal-card.prominent {
            background: linear-gradient(180deg, rgba(255,255,255,0.032), rgba(255,255,255,0.014));
            box-shadow: 0 18px 56px rgba(0,0,0,0.6);
            border: 1px solid rgba(255,255,255,0.06);
            backdrop-filter: blur(10px) saturate(130%);
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(90deg, var(--accent-soft), rgba(106,92,255,0.06));
            color: #fff;
            padding: 12px 18px;
            border-radius: 10px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.4);
            z-index: 10000;
            font-weight: 600;
            backdrop-filter: blur(8px) saturate(120%);
            border: 1px solid rgba(255,255,255,0.06);
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Form field enhancements */
        .form-group {
            margin-bottom: 16px;
            position: relative;
        }

        .form-label {
            display: block;
            margin-bottom: 6px;
            color: var(--muted);
            font-weight: 600;
            font-size: 14px;
        }

        .form-input {
            width: 100%;
            padding: 12px 14px;
            border-radius: 10px;
            border: 1px solid rgba(255,255,255,0.04);
            background: transparent;
            color: #dfefff;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .form-input:focus {
            outline: none;
            border-color: rgba(0,212,255,0.3);
            box-shadow: 0 0 15px rgba(0,212,255,0.1);
            transform: translateY(-2px);
        }

        .form-input:hover {
            border-color: rgba(255,255,255,0.08);
        }

        .form-select {
            width: 100%;
            padding: 12px 14px;
            border-radius: 10px;
            border: 1px solid rgba(255,255,255,0.04);
            background: transparent;
            color: #dfefff;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .form-select:focus {
            outline: none;
            border-color: rgba(0,212,255,0.3);
            box-shadow: 0 0 15px rgba(0,212,255,0.1);
            transform: translateY(-2px);
        }

        .form-textarea {
            width: 100%;
            padding: 12px 14px;
            border-radius: 10px;
            border: 1px solid rgba(255,255,255,0.04);
            background: transparent;
            color: #dfefff;
            transition: all 0.3s ease;
            font-size: 14px;
            resize: vertical;
            min-height: 100px;
        }

        .form-textarea:focus {
            outline: none;
            border-color: rgba(0,212,255,0.3);
            box-shadow: 0 0 15px rgba(0,212,255,0.1);
            transform: translateY(-2px);
        }

        .form-section {
            margin-bottom: 24px;
            padding: 16px;
            border-radius: 12px;
            background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));
            border: 1px solid rgba(255,255,255,0.03);
            transition: all 0.3s ease;
        }

        .form-section:hover {
            border-color: rgba(255,255,255,0.05);
            transform: translateY(-2px);
        }

        .form-section-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-section-title i {
            color: var(--accent);
        }

        /* Live Count Cards */
        .live-count-card {
            background: linear-gradient(135deg, rgba(0,212,255,0.08), rgba(106,92,255,0.08));
            border-radius: var(--card-radius);
            padding: 20px;
            border: 1px solid rgba(0,212,255,0.2);
            box-shadow: 0 8px 30px rgba(0,212,255,0.15);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s ease;
            backdrop-filter: blur(6px) saturate(120%);
            position: relative;
            overflow: hidden;
            min-width: 200px;
            margin-bottom: 20px;
        }

        .live-count-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(0,212,255,0.1), rgba(106,92,255,0.1));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .live-count-card:hover::before {
            opacity: 1;
        }

        .live-count-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 18px 50px rgba(0,212,255,0.25), 0 0 20px rgba(0,212,255,0.2);
            border-color: rgba(0,212,255,0.4);
        }

        .live-count-card .count {
            font-size: 42px;
            font-weight: 800;
            color: #fff;
            text-shadow: 0 0 15px rgba(0,212,255,0.7);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .live-count-card .label {
            font-size: 16px;
            color: #fff;
            font-weight: 600;
            text-align: center;
        }

        .live-count-card .sub-label {
            font-size: 12px;
            color: rgba(255,255,255,0.7);
            text-align: center;
        }

        .live-count-card .icon {
            font-size: 24px;
            margin-bottom: 10px;
            color: rgba(255,255,255,0.9);
        }

        /* Work History Table in Profile Modal */
        .work-history-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            font-size: 13px;
        }

        .work-history-table th {
            background: linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
            padding: 10px 8px;
            text-align: left;
            border-bottom: 1px solid rgba(255,255,255,0.03);
            color: #cfefff;
            font-weight: 600;
        }

        .work-history-table td {
            padding: 10px 8px;
            border-bottom: 1px solid rgba(255,255,255,0.02);
            color: #dbeeff;
        }

        .work-history-table tr:hover {
            background: linear-gradient(90deg, rgba(0,212,255,0.02), rgba(106,92,255,0.02));
        }

        @media (max-width: 1100px) {
            .wrap {
                padding: 18px;
            }
            .sidebar {
                display: none;
            }
            .main {
                padding: 0;
            }
            .modal-card {
                width: 92%;
            }
        }

        @media (max-width: 760px) {
            .cards {
                flex-direction: column;
                align-items: stretch;
            }
            .table-shell {
                overflow-x: auto;
            }
        }
    </style>
</head>
<body>
    <div class="wrap">
        <!-- Sidebar -->
        <aside class="sidebar" role="navigation">
            <div class="brand">
                <div class="logo">
                    <img src="https://i.pravatar.cc/80?img=67" alt="Admin Profile">
                </div>
                <div>
                    <h2>Wave Portal</h2>
                    <div style="font-size:12px;color:var(--muted)"><i class="fas fa-user-shield"></i> Admin</div>
                </div>
            </div>

            <nav class="nav" aria-label="Main navigation">
                <button class="active" data-target="dashboardPanel" onclick="switchPanel(event)"><i class="fas fa-tachometer-alt"></i> Dashboard</button>
                <button data-target="membersPanel" onclick="switchPanel(event)"><i class="fas fa-users"></i> Members</button>
                <button data-target="managersPanel" onclick="switchPanel(event)"><i class="fas fa-user-tie"></i> Managers</button>
                <button data-target="projectsPanel" onclick="switchPanel(event)"><i class="fas fa-project-diagram"></i> Projects</button>
                <button data-target="addProjectPanel" onclick="switchPanel(event)"><i class="fas fa-plus-circle"></i> Add Project</button>
                <button data-target="messagingPanel" onclick="switchPanel(event)"><i class="fas fa-comments"></i> Messaging</button>
                <button data-target="paymentsPanel" onclick="switchPanel(event)"><i class="fas fa-credit-card"></i> Payments</button>
                <button data-target="referPanel" onclick="switchPanel(event)"><i class="fas fa-qrcode"></i> Refer Codes</button>
                <button data-target="teamMembersPanel" onclick="switchPanel(event)"><i class="fas fa-user-slash"></i> Manage Team</button>
                <button data-target="settingsPanel" onclick="switchPanel(event)"><i class="fas fa-cogs"></i> Settings</button>
            </nav>

            <div class="footer">
                <div style="font-size:13px;color:var(--muted)">Signed in as</div>
                <div style="font-weight:700"><i class="fas fa-user-circle"></i> Admin • Wave</div>
                <div style="height:12px"></div>
                <button class="logout" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Log Out</button>
            </div>
        </aside>

        <!-- Main -->
        <main class="main">
            <header class="main-header">
                <div class="title">
                    <h1>Admin Dashboard</h1>
                    <p class="muted">Manage members, projects, payments & referrals</p>
                </div>
                <div class="top-actions">
                    <div class="profile-switcher">
                        <button class="profile-switcher-btn" onclick="toggleProfileDropdown()">
                            <i class="fas fa-user-circle"></i> Switch Profile <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="profile-dropdown" id="profileDropdown">
                            <div class="profile-option active" data-profile="admin" onclick="switchProfile('admin')">
                                <i class="fas fa-user-shield"></i> Admin Dashboard
                            </div>
                            <div class="profile-option" data-profile="manager" onclick="switchProfile('manager')">
                                <i class="fas fa-user-tie"></i> Manager Dashboard
                            </div>
                            <div class="profile-option" data-profile="member" onclick="switchProfile('member')">
                                <i class="fas fa-user"></i> Member Dashboard
                            </div>
                        </div>
                    </div>
                    <div class="muted"><i class="fas fa-moon"></i> Dark frosted glass</div>
                </div>
            </header>

            <!-- Cards (only visible on dashboard panel) -->
            <section class="cards" id="cardsRow">
                <div class="card" id="cardUsers"><div class="k" id="kUsers">0</div><div class="t"><i class="fas fa-users"></i> Total Users</div></div>
                <div class="card" id="cardActive"><div class="k" id="kActive">0</div><div class="t"><i class="fas fa-user-check"></i> Active Members</div></div>
                <div class="card" id="cardProjects"><div class="k" id="kProjects">0</div><div class="t"><i class="fas fa-project-diagram"></i> Total Projects</div></div>
                <div class="card" id="cardEarnings"><div class="k" id="kEarnings">$0</div><div class="t"><i class="fas fa-dollar-sign"></i> Total Earnings</div></div>
            </section>

            <section class="panel-wrap">
                <!-- Dashboard panel: recent activity table -->
                <section class="panel show" id="dashboardPanel" style="display:block">
                    <div class="panel-header">
                        <h3><i class="fas fa-history"></i> Recent Activity</h3>
                        <div class="controls muted"><i class="fas fa-bolt"></i> Live updates</div>
                    </div>

                    <div class="table-shell">
                        <div class="table-tools" style="margin-bottom:8px">
                            <div class="search"><input placeholder="Search activity..." id="activitySearch" oninput="renderActivityTable()" /></div>
                            <div style="display:flex;gap:8px;align-items:center">
                                <div class="muted"><i class="fas fa-eye"></i> Showing latest 50</div>
                            </div>
                        </div>

                        <table class="app-table" id="activityTable">
                            <thead>
                                <tr>
                                    <th><i class="fas fa-clock"></i> When</th>
                                    <th><i class="fas fa-list"></i> Activity</th>
                                    <th><i class="fas fa-tag"></i> Type</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </section>

                <!-- Members panel -->
                <section class="panel" id="membersPanel" style="display:none">
                    <div class="panel-header">
                        <h3><i class="fas fa-users"></i> Members</h3>
                        <div class="controls">
                            <button class="add-prominent" onclick="openModal('member')"><i class="fas fa-user-plus"></i> Add Member</button>

                            <div class="table-tools" style="margin-left:auto;gap:8px;align-items:center;display:flex">
                                <div class="search"><input placeholder="Search members..." data-table="membersTable" oninput="tableSearch(event)"></div>

                                <!-- Advanced filters for members -->
                                <select id="membersRoleFilter" class="select-page" onchange="applyTableFilter('membersTable','role', this.value)">
                                    <option value="">All roles</option>
                                    <option value="member">Member</option>
                                    <option value="manager">Manager</option>
                                    <option value="admin">Admin</option>
                                </select>

                                <select id="membersSpecializationFilter" class="select-page" onchange="applyTableFilter('membersTable','specialization', this.value)">
                                    <option value="">All specializations</option>
                                    <option value="Web Developer">Web Developer</option>
                                    <option value="Graphic Designer">Graphic Designer</option>
                                    <option value="SEO Expert">SEO Expert</option>
                                    <option value="Digital Marketer">Digital Marketer</option>
                                    <option value="Content Writer">Content Writer</option>
                                    <option value="Project Manager">Project Manager</option>
                                </select>

                                <select id="membersStatusFilter" class="select-page" onchange="applyTableFilter('membersTable','status', this.value)">
                                    <option value="">All status</option>
                                    <option value="active">Active</option>
                                    <option value="inactive">Inactive</option>
                                    <option value="banned">Banned</option>
                                </select>

                                <select class="select-page" data-table="membersTable" onchange="tablePageSizeChange(event)">
                                    <option value="5">5 / page</option><option value="10" selected>10 / page</option><option value="25">25 / page</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Live Member Count Card -->
                    <div class="live-count-card">
                        <div class="icon"><i class="fas fa-users"></i></div>
                        <div class="count" id="liveMemberCount">0</div>
                        <div class="label">Live Members</div>
                        <div class="sub-label">Active and working</div>
                    </div>

                    <div class="table-shell">
                        <table class="app-table" id="membersTable">
                            <thead><tr data-table="membersTable">
                                <th data-col="avatar"><i class="fas fa-image"></i> Picture</th>
                                <th data-col="name"><i class="fas fa-user"></i> Name</th>
                                <th data-col="email"><i class="fas fa-envelope"></i> Email</th>
                                <th data-col="role"><i class="fas fa-id-badge"></i> Role</th>
                                <th data-col="specialization"><i class="fas fa-tools"></i> Specialization</th>
                                <th data-col="status"><i class="fas fa-circle"></i> Status</th>
                                <th data-col="actions"><i class="fas fa-ellipsis-h"></i> Actions</th>
                            </tr></thead>
                            <tbody></tbody>
                        </table>
                        <div class="pagination" data-table="membersTable"></div>
                    </div>
                </section>

                <!-- Managers panel -->
                <section class="panel" id="managersPanel" style="display:none">
                    <div class="panel-header">
                        <h3><i class="fas fa-user-tie"></i> Managers</h3>
                        <div class="controls">
                            <button class="add-prominent" onclick="openModal('manager')"><i class="fas fa-user-tie"></i> Add Manager</button>

                            <div class="table-tools" style="margin-left:auto;gap:8px;align-items:center;display:flex">
                                <div class="search"><input placeholder="Search managers..." data-table="managersTable" oninput="tableSearch(event)"></div>

                                <!-- Advanced filters for managers -->
                                <select id="managersRoleFilter" class="select-page" onchange="applyTableFilter('managersTable','role', this.value)">
                                    <option value="">All roles</option>
                                    <option value="manager">Manager</option>
                                    <option value="admin">Admin</option>
                                </select>

                                <select id="managersSpecializationFilter" class="select-page" onchange="applyTableFilter('managersTable','specialization', this.value)">
                                    <option value="">All specializations</option>
                                    <option value="Project Management">Project Management</option>
                                    <option value="Team Lead">Team Lead</option>
                                    <option value="Operations">Operations</option>
                                    <option value="Quality Assurance">Quality Assurance</option>
                                </select>

                                <select id="managersStatusFilter" class="select-page" onchange="applyTableFilter('managersTable','status', this.value)">
                                    <option value="">All status</option>
                                    <option value="active">Active</option>
                                    <option value="inactive">Inactive</option>
                                </select>

                                <select class="select-page" data-table="managersTable" onchange="tablePageSizeChange(event)">
                                    <option value="5">5 / page</option><option value="10" selected>10 / page</option><option value="25">25 / page</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Live Manager Count Card -->
                    <div class="live-count-card">
                        <div class="icon"><i class="fas fa-user-tie"></i></div>
                        <div class="count" id="liveManagerCount">0</div>
                        <div class="label">Live Managers</div>
                        <div class="sub-label">Active and managing</div>
                    </div>

                    <div class="table-shell">
                        <table class="app-table" id="managersTable">
                            <thead><tr data-table="managersTable">
                                <th data-col="avatar"><i class="fas fa-image"></i> Picture</th>
                                <th data-col="name"><i class="fas fa-user"></i> Name</th>
                                <th data-col="email"><i class="fas fa-envelope"></i> Email</th>
                                <th data-col="phone"><i class="fas fa-phone"></i> Phone</th>
                                <th data-col="role"><i class="fas fa-id-badge"></i> Role</th>
                                <th data-col="specialization"><i class="fas fa-tools"></i> Specialization</th>
                                <th data-col="status"><i class="fas fa-circle"></i> Status</th>
                                <th data-col="actions"><i class="fas fa-ellipsis-h"></i> Actions</th>
                            </tr></thead>
                            <tbody></tbody>
                        </table>
                        <div class="pagination" data-table="managersTable"></div>
                    </div>
                </section>

                <!-- Projects panel -->
                <section class="panel" id="projectsPanel" style="display:none">
                    <div class="panel-header">
                        <h3><i class="fas fa-project-diagram"></i> Projects</h3>
                        <div class="controls">
                            <div class="table-tools" style="margin-left:auto;gap:8px;align-items:center;display:flex">
                                <div class="search"><input placeholder="Search projects..." data-table="projectsTable" oninput="tableSearch(event)"></div>

                                <!-- projects status filter -->
                                <select id="projectStatusFilter" class="select-page" onchange="applyTableFilter('projectsTable','status', this.value)">
                                    <option value="">All statuses</option>
                                    <option value="live">Live</option>
                                    <option value="in progress">In Progress</option>
                                    <option value="completed">Completed</option>
                                </select>

                                <select class="select-page" data-table="projectsTable" onchange="tablePageSizeChange(event)">
                                    <option value="5">5 / page</option><option value="10" selected>10 / page</option><option value="25">25 / page</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="table-shell">
                        <table class="app-table" id="projectsTable">
                            <thead><tr data-table="projectsTable">
                                <th data-col="name"><i class="fas fa-file-signature"></i> Name</th>
                                <th data-col="category"><i class="fas fa-tag"></i> Category</th>
                                <th data-col="budget"><i class="fas fa-dollar-sign"></i> Budget</th>
                                <th data-col="deadline"><i class="fas fa-calendar-alt"></i> Deadline</th>
                                <th data-col="priority"><i class="fas fa-flag"></i> Priority</th>
                                <th data-col="status"><i class="fas fa-info-circle"></i> Status</th>
                                <th data-col="accepted"><i class="fas fa-user-check"></i> Accepted By</th>
                                <th data-col="actions"><i class="fas fa-ellipsis-h"></i> Actions</th>
                            </tr></thead>
                            <tbody></tbody>
                        </table>
                        <div class="pagination" data-table="projectsTable"></div>
                    </div>
                </section>

                <!-- Add Project panel -->
                <section class="panel" id="addProjectPanel" style="display:none">
                    <div class="panel-header">
                        <h3><i class="fas fa-plus-circle"></i> Add New Project</h3>
                        <div class="controls muted">Fill in project details below</div>
                    </div>

                    <div class="form-section">
                        <div class="form-section-title"><i class="fas fa-info-circle"></i> Basic Information</div>
                        <div style="display:flex;gap:12px;flex-wrap:wrap">
                            <div class="form-group" style="min-width:300px;flex:1">
                                <label class="form-label">Project Name</label>
                                <input class="form-input" id="projectName" placeholder="Enter project name">
                            </div>
                            <div class="form-group" style="min-width:200px">
                                <label class="form-label">Category</label>
                                <select class="form-select" id="projectCategory">
                                    <option value="">Select Category</option>
                                    <option value="Web Development">Web Development</option>
                                    <option value="Mobile App">Mobile App</option>
                                    <option value="Digital Marketing">Digital Marketing</option>
                                    <option value="Graphic Design">Graphic Design</option>
                                    <option value="SEO">SEO</option>
                                    <option value="Content Writing">Content Writing</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Project Description</label>
                            <textarea class="form-textarea" id="projectDescription" placeholder="Enter project description"></textarea>
                        </div>
                    </div>

                    <div class="form-section">
                        <div class="form-section-title"><i class="fas fa-cog"></i> Project Details</div>
                        <div style="display:flex;gap:12px;flex-wrap:wrap">
                            <div class="form-group" style="min-width:200px">
                                <label class="form-label">Budget</label>
                                <input class="form-input" id="projectBudget" placeholder="$0.00">
                            </div>
                            <div class="form-group" style="min-width:200px">
                                <label class="form-label">Deadline</label>
                                <input class="form-input" id="projectDeadline" type="date">
                            </div>
                            <div class="form-group" style="min-width:200px">
                                <label class="form-label">Priority</label>
                                <select class="form-select" id="projectPriority">
                                    <option value="Low">Low</option>
                                    <option value="Medium">Medium</option>
                                    <option value="High">High</option>
                                    <option value="Urgent">Urgent</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Requirements</label>
                            <textarea class="form-textarea" id="projectRequirements" placeholder="Enter project requirements"></textarea>
                        </div>
                    </div>

                    <div style="margin-top:12px">
                        <button class="btn edit" onclick="addNewProject()"><i class="fas fa-save"></i> Add Project</button>
                    </div>

                    <div style="margin-top:30px">
                        <h4><i class="fas fa-history"></i> Project History</h4>
                        <div class="table-shell" style="margin-top:12px">
                            <table class="app-table" id="projectHistoryTable">
                                <thead><tr>
                                    <th>Project Name</th>
                                    <th>Category</th>
                                    <th>Budget</th>
                                    <th>Status</th>
                                    <th>Date Added</th>
                                </tr></thead>
                                <tbody></tbody>
                        </table>
                        </div>
                    </div>
                </section>

                <!-- Messaging panel -->
                <section class="panel" id="messagingPanel" style="display:none">
                    <div class="panel-header">
                        <h3><i class="fas fa-comments"></i> Messaging</h3>
                        <div class="controls muted">Communicate with team members</div>
                    </div>

                    <div style="display:flex;gap:20px;height:400px">
                        <div style="width:300px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005)); border-radius:12px; padding:15px; border:1px solid rgba(255,255,255,0.03); overflow-y:auto">
                            <h4 style="margin-bottom:15px">Conversations</h4>
                            <div id="conversationList">
                                <!-- Conversations will be dynamically added here -->
                            </div>
                        </div>

                        <div style="flex:1;display:flex;flex-direction:column;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005)); border-radius:12px; border:1px solid rgba(255,255,255,0.03); overflow:hidden">
                            <div style="padding:15px;border-bottom:1px solid rgba(255,255,255,0.03)">
                                <h4 id="activeConversation">Select a conversation</h4>
                            </div>
                            <div id="messageArea" style="flex:1;padding:15px;overflow-y:auto">
                                <!-- Messages will be displayed here -->
                            </div>
                            <div style="padding:15px;border-top:1px solid rgba(255,255,255,0.03)">
                                <div style="display:flex;gap:10px">
                                    <input id="messageInput" placeholder="Type your message..." style="flex:1;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:#dfefff">
                                    <button class="btn edit" onclick="sendMessage()"><i class="fas fa-paper-plane"></i> Send</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Payments panel -->
                <section class="panel" id="paymentsPanel" style="display:none">
                    <div class="panel-header">
                        <h3><i class="fas fa-credit-card"></i> Payments</h3>
                        <div class="controls muted">Payment details for completed projects</div>
                    </div>

                    <div class="table-shell">
                        <table class="app-table" id="paymentsTable">
                            <thead><tr data-table="paymentsTable">
                                <th data-col="member"><i class="fas fa-user"></i> Member</th>
                                <th data-col="amount"><i class="fas fa-dollar-sign"></i> Amount</th>
                                <th data-col="due"><i class="fas fa-calendar-alt"></i> Due Date</th>
                                <th data-col="method"><i class="fas fa-credit-card"></i> Payment Method</th>
                                <th data-col="address"><i class="fas fa-map-marker-alt"></i> Receiving Address</th>
                                <th data-col="status"><i class="fas fa-info-circle"></i> Status</th>
                            </tr></thead>
                            <tbody></tbody>
                        </table>
                        <div class="pagination" data-table="paymentsTable"></div>
                    </div>
                </section>

                <!-- Refer panel -->
                <section class="panel" id="referPanel" style="display:none">
                    <div class="panel-header">
                        <h3><i class="fas fa-qrcode"></i> Refer Codes</h3>
                        <div class="controls muted">Generate codes & track usage</div>
                    </div>

                    <div style="display:flex;gap:12px;flex-wrap:wrap;margin-bottom:12px">
                        <div class="refer-box">
                            <div>
                                <div class="muted">Admin</div>
                                <div style="display:flex;gap:8px;align-items:center">
                                    <div class="refer-code" id="adminRefer">—</div>
                                    <button id="adminCopyBtn" class="btn copy" onclick="copyReferCode('admin', this)" title="Copy admin code"><i class="fas fa-copy"></i> Copy</button>
                                </div>
                            </div>
                            <div><button class="btn regen" onclick="regenUI('admin')" title="Regenerate admin code"><i class="fas fa-sync"></i> Regenerate</button></div>
                        </div>

                        <div class="refer-box">
                            <div>
                                <div class="muted">Manager</div>
                                <div style="display:flex;gap:8px;align-items:center">
                                    <div class="refer-code" id="managerRefer">—</div>
                                    <button id="managerCopyBtn" class="btn copy" onclick="copyReferCode('manager', this)" title="Copy manager code"><i class="fas fa-copy"></i> Copy</button>
                                </div>
                            </div>
                            <div><button class="btn regen" onclick="regenUI('manager')" title="Regenerate manager code"><i class="fas fa-sync"></i> Regenerate</button></div>
                        </div>

                        <div style="display:flex;align-items:center;gap:12px;margin-left:auto">
                            <button class="btn admin" onclick="simulateSignupFromRefer()"><i class="fas fa-user-plus"></i> Simulate New Sign-Up</button>
                        </div>
                    </div>

                    <div class="table-shell">
                        <div class="table-tools" style="margin-bottom:10px">
                            <div class="search"><input placeholder="Search refer usage..." data-table="referTable" oninput="tableSearch(event)"></div>

                            <select id="referTypeFilter" class="select-page" onchange="applyTableFilter('referTable','type', this.value)">
                                <option value="">All types</option>
                                <option value="Admin">Admin</option>
                                <option value="Manager">Manager</option>
                            </select>

                            <select class="select-page" data-table="referTable" onchange="tablePageSizeChange(event)">
                                <option value="5">5 / page</option><option value="10" selected>10 / page</option>
                            </select>
                        </div>

                        <table class="app-table" id="referTable">
                            <thead><tr data-table="referTable">
                                <th data-col="when"><i class="fas fa-clock"></i> When</th>
                                <th data-col="user"><i class="fas fa-user"></i> User</th><th data-col="email"><i class="fas fa-envelope"></i> Email</th><th data-col="code"><i class="fas fa-qrcode"></i> Refer Code</th><th data-col="type"><i class="fas fa-user-tag"></i> Account Type</th><th data-col="actions"><i class="fas fa-ellipsis-h"></i> Actions</th>
                            </tr></thead>
                            <tbody></tbody>
                        </table>
                        <div class="pagination" data-table="referTable"></div>
                    </div>
                </section>

                <!-- Manage Team Members panel -->
                <section class="panel" id="teamMembersPanel" style="display:none">
                    <div class="panel-header">
                        <h3><i class="fas fa-user-slash"></i> Manage Team Members</h3>
                        <div class="controls muted">Manage blocked and deleted members</div>
                    </div>

                    <div class="table-tools" style="margin-bottom: 15px;">
                        <div class="search"><input placeholder="Search deleted members..." id="teamMembersSearch" oninput="filterTeamMembers()"></div>
                    </div>

                    <div class="table-shell">
                        <table class="app-table" id="teamMembersTable">
                            <thead><tr>
                                <th><i class="fas fa-user"></i> Name</th>
                                <th><i class="fas fa-envelope"></i> Email</th>
                                <th><i class="fas fa-id-badge"></i> Role</th>
                                <th><i class="fas fa-network-wired"></i> IP Address</th>
                                <th><i class="fas fa-calendar-alt"></i> Deleted Date</th>
                                <th><i class="fas fa-info-circle"></i> Status</th>
                                <th><i class="fas fa-ellipsis-h"></i> Actions</th>
                            </tr></thead>
                            <tbody></tbody>
                        </table>
                        <div class="pagination" data-table="teamMembersTable"></div>
                    </div>
                </section>

                <!-- Settings -->
                <section class="panel" id="settingsPanel" style="display:none">
                    <div class="panel-header">
                        <h3><i class="fas fa-cogs"></i> Settings</h3>
                        <div class="muted">Update admin profile & work hours</div>
                    </div>
                    
                    <div class="form-section">
                        <div class="form-section-title"><i class="fas fa-user"></i> Profile Information</div>
                        <div style="display:flex;gap:20px;align-items:flex-start">
                            <div style="display:flex;flex-direction:column;align-items:center;gap:10px">
                                <div class="avatar" style="width:100px;height:100px;border-radius:50%;overflow:hidden">
                                    <img src="https://i.pravatar.cc/150?img=67" alt="Admin Profile" id="adminProfileImage">
                                </div>
                                <button class="btn edit" onclick="changeProfileImage()"><i class="fas fa-camera"></i> Change Photo</button>
                            </div>
                            
                            <div style="flex:1;display:flex;flex-direction:column;gap:16px">
                                <div style="display:flex;gap:12px;flex-wrap:wrap">
                                    <div class="form-group" style="min-width:300px;flex:1">
                                        <label class="form-label">Name</label>
                                        <input class="form-input" id="adminName" placeholder="Admin name" value="Admin Wave">
                                    </div>
                                    <div class="form-group" style="min-width:300px;flex:1">
                                        <label class="form-label">Email</label>
                                        <input class="form-input" id="adminEmail" placeholder="admin@example.com" value="admin@wave.local">
                                    </div>
                                </div>
                                
                                <div style="display:flex;gap:12px;flex-wrap:wrap">
                                    <div class="form-group" style="min-width:300px;flex:1">
                                        <label class="form-label">Work Hours / Experience</label>
                                        <input class="form-input" id="adminWork" placeholder="e.g. 9am - 6pm / 5 years" value="9am - 6pm / 5 years">
                                    </div>
                                    <div class="form-group" style="min-width:300px;flex:1">
                                        <label class="form-label">Phone</label>
                                        <input class="form-input" id="adminPhone" placeholder="+1 234 567 8900" value="+1 234 567 8900">
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Bio</label>
                                    <textarea class="form-textarea" id="adminBio" placeholder="Write something about yourself...">Experienced administrator with 5+ years in team management and project coordination.</textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top:20px">
                        <button class="btn edit" onclick="saveSettings()"><i class="fas fa-save"></i> Save Settings</button>
                        <button class="btn del" onclick="resetAllData()"><i class="fas fa-eraser"></i> Reset Data</button>
                    </div>
                </section>
            </section>
        </main>
    </div>

    <!-- Generic modal backdrop -->
    <div id="modalBackdrop" class="modal-backdrop" role="dialog" aria-hidden="true">
        <div class="modal-card prominent" id="modalCard" style="width: 600px;">
            <h3 id="modalTitle"><i class="fas fa-edit"></i> Modal</h3>
            <div id="modalBody"></div>
            <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
                <button class="btn del" onclick="closeModal()"><i class="fas fa-times"></i> Cancel</button>
                <button class="btn edit" id="modalPrimaryBtn"><i class="fas fa-save"></i> Save</button>
            </div>
        </div>
    </div>

    <!-- View Member/Manager Modal -->
    <div id="viewModal" class="modal-backdrop" role="dialog" aria-hidden="true">
        <div class="modal-card prominent" style="width: 800px; max-height: 90vh;">
            <h3 id="viewModalTitle"><i class="fas fa-user"></i> Profile Details</h3>
            <div id="viewModalBody" style="max-height: calc(90vh - 120px); overflow-y: auto;"></div>
            <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
                <button class="btn del" onclick="closeViewModal()"><i class="fas fa-times"></i> Close</button>
            </div>
        </div>
    </div>

    <!-- View Project Modal -->
    <div id="viewProjectModal" class="modal-backdrop" role="dialog" aria-hidden="true">
        <div class="modal-card prominent" style="width: 700px;">
            <h3 id="viewProjectModalTitle"><i class="fas fa-project-diagram"></i> Project Details</h3>
            <div id="viewProjectModalBody"></div>
            <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
                <button class="btn del" onclick="closeViewProjectModal()"><i class="fas fa-times"></i> Close</button>
            </div>
        </div>
    </div>

    <script>
        // State management
        const STORAGE_KEY = 'wave_portal_state_v6';
        
        const defaultSeed = {
            members: [
                {id:1, avatar:'https://i.pravatar.cc/80?img=12', name:'John Doe', email:'john@example.com', status:'active', role:'member', specialization:'Web Developer', phone:'+1 234 567 8901', bio:'Full-stack developer with 3 years of experience', joinDate:'2023-01-15', password: 'password123', paymentMethod: 'PayPal', paymentAddress: 'john.doe@paypal.com', ipAddress: '192.168.1.101', dashboardAccess: ['member'], earnings: 1200, projectsCompleted: 5, workHistory: [
                    {projectName: 'Website Redesign', budget: '$2,500', acceptDate: '2023-02-01', submissionDate: '2023-03-15'},
                    {projectName: 'E-commerce Platform', budget: '$3,500', acceptDate: '2023-04-10', submissionDate: '2023-06-20'},
                    {projectName: 'Mobile App UI', budget: '$1,800', acceptDate: '2023-07-05', submissionDate: '2023-08-25'},
                    {projectName: 'Dashboard Design', budget: '$1,200', acceptDate: '2023-09-12', submissionDate: '2023-10-30'},
                    {projectName: 'API Integration', budget: '$2,000', acceptDate: '2023-11-15', submissionDate: '2023-12-20'}
                ]},
                {id:2, avatar:'https://i.pravatar.cc/80?img=14', name:'Maya Lee', email:'maya@example.com', status:'active', role:'member', specialization:'Graphic Designer', phone:'+1 234 567 8902', bio:'Creative designer specializing in branding and UI/UX', joinDate:'2023-03-22', password: 'password123', paymentMethod: 'Bank Transfer', paymentAddress: 'Account: 123456789, Bank: ABC Bank', ipAddress: '192.168.1.102', dashboardAccess: ['member'], earnings: 950, projectsCompleted: 3, workHistory: [
                    {projectName: 'Logo Design', budget: '$800', acceptDate: '2023-04-05', submissionDate: '2023-05-10'},
                    {projectName: 'Brand Identity', budget: '$1,500', acceptDate: '2023-06-15', submissionDate: '2023-08-01'},
                    {projectName: 'Marketing Materials', budget: '$1,200', acceptDate: '2023-09-10', submissionDate: '2023-10-25'}
                ]},
                {id:3, avatar:'https://i.pravatar.cc/80?img=4', name:'Peter Q', email:'peter@company.com', status:'banned', role:'member', specialization:'SEO Expert', phone:'+1 234 567 8903', bio:'SEO specialist with focus on technical optimization', joinDate:'2022-11-05', password: 'password123', paymentMethod: 'PayPal', paymentAddress: 'peter.q@paypal.com', ipAddress: '192.168.1.103', dashboardAccess: ['member'], earnings: 800, projectsCompleted: 2, workHistory: [
                    {projectName: 'SEO Audit', budget: '$1,000', acceptDate: '2022-12-01', submissionDate: '2023-01-15'},
                    {projectName: 'Keyword Research', budget: '$600', acceptDate: '2023-02-10', submissionDate: '2023-03-20'}
                ]}
            ],
            managers: [
                {id:1, avatar:'https://i.pravatar.cc/80?img=8', name:'Alice K', email:'alice@corp.com', phone:'+8801234567', status:'active', role:'manager', specialization:'Project Management', bio:'Experienced project manager with PMP certification', joinDate:'2022-08-10', password: 'password123', paymentMethod: 'Bank Transfer', paymentAddress: 'Account: 987654321, Bank: XYZ Bank', ipAddress: '192.168.1.201', dashboardAccess: ['manager'], earnings: 2500, projectsCompleted: 12, workHistory: [
                    {projectName: 'Website Redesign', budget: '$5,000', acceptDate: '2022-09-01', submissionDate: '2022-11-15'},
                    {projectName: 'Mobile App', budget: '$8,500', acceptDate: '2022-12-05', submissionDate: '2023-03-20'},
                    {projectName: 'Marketing Campaign', budget: '$3,200', acceptDate: '2023-04-10', submissionDate: '2023-06-30'},
                    {projectName: 'CRM Implementation', budget: '$6,000', acceptDate: '2023-07-15', submissionDate: '2023-10-05'},
                    {projectName: 'E-commerce Platform', budget: '$10,000', acceptDate: '2023-11-01', submissionDate: '2024-02-15'}
                ]},
                {id:2, avatar:'https://i.pravatar.cc/80?img=9', name:'Bob R', email:'bob@corp.com', phone:'+8807654321', status:'inactive', role:'manager', specialization:'Team Lead', bio:'Team lead with strong leadership skills', joinDate:'2023-02-18', password: 'password123', paymentMethod: 'PayPal', paymentAddress: 'bob.r@paypal.com', ipAddress: '192.168.1.202', dashboardAccess: ['manager'], earnings: 1800, projectsCompleted: 8, workHistory: [
                    {projectName: 'Mobile App Development', budget: '$7,500', acceptDate: '2023-03-01', submissionDate: '2023-06-15'},
                    {projectName: 'Website Migration', budget: '$4,200', acceptDate: '2023-07-10', submissionDate: '2023-09-25'},
                    {projectName: 'Database Optimization', budget: '$3,000', acceptDate: '2023-10-05', submissionDate: '2023-12-20'}
                ]}
            ],
            projects: [
                {id:1, name:'Website Redesign', category:'Web Development', budget:'$5,000', status:'live', accepted:'Alice K', completed:'', deadline:'2023-12-15', priority:'High', description:'Complete redesign of company website with modern UI/UX and responsive design', requirements:'Responsive design, CMS integration, SEO optimization', createdAt: new Date().toISOString()},
                {id:2, name:'Mobile App', category:'Mobile App', budget:'$8,500', status:'in progress', accepted:'Maya Lee', completed:'', deadline:'2024-02-20', priority:'Medium', description:'Development of a cross-platform mobile application for iOS and Android', requirements:'iOS and Android compatibility, push notifications, offline functionality', createdAt: new Date().toISOString()},
                {id:3, name:'Marketing Sprint', category:'Digital Marketing', budget:'$2,200', status:'completed', accepted:'Bob R', completed:'Bob R', deadline:'2023-10-30', priority:'Low', description:'Two-week marketing campaign focusing on social media and email marketing', requirements:'Social media integration, email templates, analytics tracking', createdAt: new Date().toISOString()}
            ],
            payments: [
                {id:1, member:'John Doe', amount:'$200', due:'2025-11-05', status:'pending', method:'PayPal', address:'john.doe@paypal.com', createdAt: new Date().toISOString()},
                {id:2, member:'Maya Lee', amount:'$150', due:'2025-11-10', status:'pending', method:'Bank Transfer', address:'Account: 123456789, Bank: ABC Bank', createdAt: new Date().toISOString()},
                {id:3, member:'Bob R', amount:'$300', due:'2025-10-25', status:'completed', method:'PayPal', address:'bob.r@paypal.com', createdAt: new Date().toISOString()}
            ],
            referUsage: [
                {id:1, when: new Date().toISOString(), user:'John Doe', email:'john@example.com', code:'ADM12345', type:'Admin'}
            ],
            adminRefer: 'ADM' + Math.floor(Math.random()*90000+10000),
            managerRefer: 'MNG' + Math.floor(Math.random()*90000+10000),
            settings: { 
                adminName: 'Admin Wave', 
                adminEmail: 'admin@wave.local', 
                adminWork: '9am - 6pm / 5 years',
                adminPhone: '+1 234 567 8900',
                adminBio: 'Experienced administrator with 5+ years in team management and project coordination.',
                adminImage: 'https://i.pravatar.cc/150?img=67'
            },
            messages: [
                {id: 1, from: 'Alice K', to: 'Admin', text: 'I have accepted the Website Redesign project', timestamp: new Date().toISOString(), projectId: 1},
                {id: 2, from: 'Admin', to: 'Alice K', text: 'Great! Please keep me updated on the progress', timestamp: new Date().toISOString(), projectId: 1}
            ],
            activities: [
                {id: 1, when: new Date().toISOString(), text: 'John Doe registered using admin code', type: 'signup'},
                {id: 2, when: new Date(Date.now() - 3600000).toISOString(), text: 'Website Redesign project created', type: 'project'},
                {id: 3, when: new Date(Date.now() - 7200000).toISOString(), text: 'Alice K accepted Website Redesign project', type: 'accept'},
                {id: 4, when: new Date(Date.now() - 10800000).toISOString(), text: 'Payment of $300 completed for Bob R', type: 'payment'}
            ],
            deletedMembers: [],
            blockedIPs: []
        };

        let State = JSON.parse(JSON.stringify(defaultSeed));

        // Load state from localStorage
        function loadState() {
            try {
                const raw = localStorage.getItem(STORAGE_KEY);
                if (raw) {
                    const parsed = JSON.parse(raw);
                    State = {...State, ...parsed};
                    return true;
                }
            } catch(e) {
                console.error('Failed to load state', e);
            }
            return false;
        }

        // Save state to localStorage
        function saveState() {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(State));
            } catch(e) {
                console.error('Failed to save state', e);
            }
        }

        // Initialize
        if (!loadState()) {
            saveState();
        }

        // DOM utility functions
        const q = s => document.querySelector(s);
        const qA = s => document.querySelectorAll(s);
        
        function el(tag, props = {}, children = []) {
            const E = document.createElement(tag);
            Object.assign(E, props);
            (Array.isArray(children) ? children : [children]).forEach(c => {
                if (c == null) return;
                if (typeof c === 'string') E.appendChild(document.createTextNode(c));
                else E.appendChild(c);
            });
            return E;
        }

        function escapeHtml(str) {
            if (!str && str !== 0) return '';
            return String(str).replace(/[&<>"']/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[s]));
        }

        // Profile switching functionality
        function toggleProfileDropdown() {
            const dropdown = document.getElementById('profileDropdown');
            dropdown.classList.toggle('show');
        }

        function switchProfile(profileType) {
            const dropdown = document.getElementById('profileDropdown');
            dropdown.classList.remove('show');
            
            // Update active state in dropdown
            document.querySelectorAll('.profile-option').forEach(option => {
                option.classList.remove('active');
            });
            document.querySelector(`.profile-option[data-profile="${profileType}"]`).classList.add('active');
            
            // Show notification
            showNotification(`Switching to ${profileType} dashboard...`);
            
            // In a real application, this would redirect to the appropriate dashboard
            setTimeout(() => {
                if (profileType === 'admin') {
                    // Already in admin dashboard
                    showNotification('You are now in Admin Dashboard');
                } else {
                    // For demo purposes, we'll just show an alert
                    alert(`In a real application, this would redirect to ${profileType}-dashboard.html`);
                    // window.location.href = `${profileType}-dashboard.html`;
                }
            }, 1000);
        }

        // Logout functionality
        function logout() {
            if (confirm('Are you sure you want to log out?')) {
                showNotification('Logging out...');
                setTimeout(() => {
                    // In a real application, this would redirect to index.html
                    alert('In a real application, this would redirect to index.html');
                    // window.location.href = 'index.html';
                }, 1000);
            }
        }

        // Show notification
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transition = 'opacity 0.3s';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // Panel switching
        function switchPanel(e) {
            const btn = e.currentTarget;
            document.querySelectorAll('.nav button').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            const target = btn.dataset.target;
            document.querySelectorAll('.panel').forEach(p => { p.style.display = 'none'; p.classList.remove('show'); });
            const panel = document.getElementById(target);
            if (!panel) return;
            panel.style.display = 'block';
            setTimeout(() => panel.classList.add('show'), 20);

            // Show/hide dashboard cards
            if (target === 'dashboardPanel') {
                document.getElementById('cardsRow').style.display = 'flex';
            } else {
                document.getElementById('cardsRow').style.display = 'none';
            }
            
            // Update stats when switching to dashboard
            if (target === 'dashboardPanel') {
                updateStats();
                renderActivityTable();
            }
            
            // Update tables when switching to panels
            if (target === 'membersPanel' || target === 'managersPanel' || target === 'projectsPanel' || target === 'paymentsPanel' || target === 'teamMembersPanel') {
                updateTables();
            }
            
            // Update project history when switching to add project panel
            if (target === 'addProjectPanel') {
                updateProjectHistory();
            }
            
            // Update live counts when switching to member or manager panels
            if (target === 'membersPanel') {
                updateLiveMemberCount();
            }
            if (target === 'managersPanel') {
                updateLiveManagerCount();
            }
        }

        // Update statistics
        function updateStats() {
            // Total Users includes all members, managers, and admin
            document.getElementById('kUsers').innerText = State.members.length + State.managers.length + 1; // +1 for admin
            
            // Active Members (only members with active status)
            document.getElementById('kActive').innerText = State.members.filter(m => m.status === 'active').length;
            
            // Total Projects
            document.getElementById('kProjects').innerText = State.projects.length;
            
            // Total Earnings from completed payments
            const totalEarnings = State.payments
                .filter(p => p.status === 'completed')
                .reduce((sum, payment) => {
                    const amount = parseFloat(payment.amount.replace('$', '').replace(',', ''));
                    return sum + (isNaN(amount) ? 0 : amount);
                }, 0);
            document.getElementById('kEarnings').innerText = '$' + totalEarnings.toLocaleString();
            
            setReferDisplay();
        }

        // Update live member count
        function updateLiveMemberCount() {
            const activeMembers = State.members.filter(m => m.status === 'active' && m.role === 'member').length;
            document.getElementById('liveMemberCount').innerText = activeMembers;
        }

        // Update live manager count
        function updateLiveManagerCount() {
            const activeManagers = State.managers.filter(m => m.status === 'active').length;
            document.getElementById('liveManagerCount').innerText = activeManagers;
        }

        // Render activity table
        function renderActivityTable() {
            const tbody = document.querySelector('#activityTable tbody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            // Sort activities by date (newest first)
            const sortedActivities = [...State.activities].sort((a, b) => new Date(b.when) - new Date(a.when));
            
            // Get search term
            const searchTerm = document.getElementById('activitySearch')?.value?.toLowerCase() || '';
            
            // Filter activities based on search term
            const filteredActivities = sortedActivities.filter(activity => 
                activity.text.toLowerCase().includes(searchTerm) || 
                activity.type.toLowerCase().includes(searchTerm)
            );
            
            // Show only latest 50 activities
            filteredActivities.slice(0, 50).forEach(activity => {
                const tr = document.createElement('tr');
                const when = new Date(activity.when).toLocaleString();
                tr.innerHTML = `
                    <td>${escapeHtml(when)}</td>
                    <td>${escapeHtml(activity.text)}</td>
                    <td><span class="badge ${activity.type === 'signup' ? 'live' : activity.type === 'project' ? 'pending' : 'completed'}">${escapeHtml(activity.type)}</span></td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Update tables
        function updateTables() {
            // Update members table
            const membersTable = document.querySelector('#membersTable tbody');
            if (membersTable) {
                membersTable.innerHTML = '';
                State.members.forEach(member => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td><div class="avatar"><img src="${member.avatar}" /></div></td>
                        <td>${escapeHtml(member.name)}</td>
                        <td>${escapeHtml(member.email)}</td>
                        <td><span class="muted" style="font-weight:700">${escapeHtml(member.role)}</span></td>
                        <td>${escapeHtml(member.specialization)}</td>
                        <td><span class="badge ${member.status==='active' ? 'live' : member.status==='banned' ? 'pending' : ''}">${escapeHtml(member.status)}</span></td>
                        <td>
                            <button class="btn view" onclick="viewProfile('member', ${member.id})"><i class="fas fa-eye"></i> View</button>
                            <button class="btn edit" onclick="editMember(${member.id})"><i class="fas fa-edit"></i> Edit</button>
                            ${member.role === 'member' ? `<button class="btn admin" onclick="promoteToManager(${member.id})"><i class="fas fa-user-tie"></i> Promotion</button>` : ''}
                            <button class="btn del" onclick="deleteMember(${member.id})"><i class="fas fa-trash"></i> Delete</button>
                        </td>
                    `;
                    membersTable.appendChild(tr);
                });
            }
            
            // Update managers table
            const managersTable = document.querySelector('#managersTable tbody');
            if (managersTable) {
                managersTable.innerHTML = '';
                State.managers.forEach(manager => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td><div class="avatar"><img src="${manager.avatar}" /></div></td>
                        <td>${escapeHtml(manager.name)}</td>
                        <td>${escapeHtml(manager.email)}</td>
                        <td>${escapeHtml(manager.phone)}</td>
                        <td><span class="muted" style="font-weight:700">${escapeHtml(manager.role)}</span></td>
                        <td>${escapeHtml(manager.specialization)}</td>
                        <td><span class="badge ${manager.status==='active' ? 'live' : 'pending'}">${escapeHtml(manager.status)}</span></td>
                        <td>
                            <button class="btn view" onclick="viewProfile('manager', ${manager.id})"><i class="fas fa-eye"></i> View</button>
                            <button class="btn edit" onclick="editManager(${manager.id})"><i class="fas fa-edit"></i> Edit</button>
                            ${manager.role === 'manager' ? `<button class="btn member" onclick="demoteToMember(${manager.id})"><i class="fas fa-user"></i> Demotion</button>` : ''}
                            <button class="btn del" onclick="deleteManager(${manager.id})"><i class="fas fa-trash"></i> Delete</button>
                        </td>
                    `;
                    managersTable.appendChild(tr);
                });
            }
            
            // Update projects table
            const projectsTable = document.querySelector('#projectsTable tbody');
            if (projectsTable) {
                projectsTable.innerHTML = '';
                State.projects.forEach(project => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${escapeHtml(project.name)}</td>
                        <td>${escapeHtml(project.category)}</td>
                        <td>${escapeHtml(project.budget)}</td>
                        <td>${escapeHtml(project.deadline)}</td>
                        <td>${escapeHtml(project.priority)}</td>
                        <td><span class="badge ${project.status==='live' ? 'live' : project.status==='in progress' ? 'pending' : 'completed'}">${escapeHtml(project.status)}</span></td>
                        <td>
                            ${project.accepted ? 
                                `<div style="display:flex;align-items:center;gap:8px">
                                    <span>${escapeHtml(project.accepted)}</span>
                                    <button class="btn view" onclick="viewProfileByName('${project.accepted}')"><i class="fas fa-eye"></i> View Profile</button>
                                </div>` : 
                                '-'
                            }
                        </td>
                        <td>
                            <button class="btn view" onclick="viewProject(${project.id})"><i class="fas fa-eye"></i> View</button>
                        </td>
                    `;
                    projectsTable.appendChild(tr);
                });
            }
            
            // Update payments table
            const paymentsTable = document.querySelector('#paymentsTable tbody');
            if (paymentsTable) {
                paymentsTable.innerHTML = '';
                State.payments.forEach(payment => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${escapeHtml(payment.member)}</td>
                        <td>${escapeHtml(payment.amount)}</td>
                        <td>${escapeHtml(payment.due)}</td>
                        <td>${escapeHtml(payment.method)}</td>
                        <td>${escapeHtml(payment.address)}</td>
                        <td>
                            <select onchange="updatePaymentStatus(${payment.id}, this.value)" style="padding:6px;border-radius:8px;background:transparent;color:#dfefff;border:1px solid rgba(255,255,255,0.04)">
                                <option value="pending" ${payment.status==='pending'?'selected':''}>pending</option>
                                <option value="completed" ${payment.status==='completed'?'selected':''}>completed</option>
                            </select>
                        </td>
                    `;
                    paymentsTable.appendChild(tr);
                });
            }
            
            // Update team members table
            const teamMembersTable = document.querySelector('#teamMembersTable tbody');
            if (teamMembersTable) {
                teamMembersTable.innerHTML = '';
                State.deletedMembers.forEach(member => {
                    const isBlocked = State.blockedIPs.includes(member.ipAddress);
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${escapeHtml(member.name)}</td>
                        <td>${escapeHtml(member.email)}</td>
                        <td><span class="muted" style="font-weight:700">${escapeHtml(member.role)}</span></td>
                        <td>${escapeHtml(member.ipAddress)}</td>
                        <td>${new Date(member.deletedDate).toLocaleDateString()}</td>
                        <td><span class="badge ${isBlocked ? 'blocked' : 'pending'}">${isBlocked ? 'Blocked' : 'Deleted'}</span></td>
                        <td>
                            ${isBlocked ? 
                                `<button class="btn admin" onclick="unblockIP('${member.ipAddress}', '${member.email}')"><i class="fas fa-unlock"></i> Unblock</button>` : 
                                `<button class="btn del" onclick="blockIP('${member.ipAddress}', '${member.email}')"><i class="fas fa-ban"></i> Block IP</button>`
                            }
                        </td>
                    `;
                    teamMembersTable.appendChild(tr);
                });
            }
        }

        // View profile by name
        function viewProfileByName(name) {
            // Search in members
            let profile = State.members.find(m => m.name === name);
            if (profile) {
                viewProfile('member', profile.id);
                return;
            }
            
            // Search in managers
            profile = State.managers.find(m => m.name === name);
            if (profile) {
                viewProfile('manager', profile.id);
                return;
            }
            
            showNotification('Profile not found');
        }

        // Filter team members table
        function filterTeamMembers() {
            const searchTerm = document.getElementById('teamMembersSearch').value.toLowerCase();
            const rows = document.querySelectorAll('#teamMembersTable tbody tr');
            
            rows.forEach(row => {
                const name = row.cells[0].textContent.toLowerCase();
                const email = row.cells[1].textContent.toLowerCase();
                const role = row.cells[2].textContent.toLowerCase();
                const ip = row.cells[3].textContent.toLowerCase();
                
                if (name.includes(searchTerm) || email.includes(searchTerm) || role.includes(searchTerm) || ip.includes(searchTerm)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        // Add new project
        function addNewProject() {
            const name = document.getElementById('projectName').value.trim();
            const category = document.getElementById('projectCategory').value;
            const budget = document.getElementById('projectBudget').value.trim();
            const deadline = document.getElementById('projectDeadline').value;
            const priority = document.getElementById('projectPriority').value;
            const description = document.getElementById('projectDescription').value.trim();
            const requirements = document.getElementById('projectRequirements').value.trim();
            
            if (!name || !category || !budget || !deadline) {
                alert('Please fill in all required fields');
                return;
            }
            
            const id = State.projects.length ? Math.max(...State.projects.map(p => p.id)) + 1 : 1;
            const newProject = {
                id,
                name,
                category,
                budget,
                deadline,
                priority,
                description,
                requirements,
                status: 'in progress',
                accepted: '',
                completed: '',
                createdAt: new Date().toISOString()
            };
            
            State.projects.unshift(newProject);
            
            // Add activity
            State.activities.unshift({
                id: State.activities.length ? Math.max(...State.activities.map(a => a.id)) + 1 : 1,
                when: new Date().toISOString(),
                text: `${name} project created`,
                type: 'project'
            });
            
            saveState();
            
            // Clear form
            document.getElementById('projectName').value = '';
            document.getElementById('projectCategory').value = '';
            document.getElementById('projectBudget').value = '';
            document.getElementById('projectDeadline').value = '';
            document.getElementById('projectPriority').value = 'Medium';
            document.getElementById('projectDescription').value = '';
            document.getElementById('projectRequirements').value = '';
            
            // Update project history table
            updateProjectHistory();
            
            showNotification('Project added successfully!');
        }

        // Update project history table
        function updateProjectHistory() {
            const tbody = document.querySelector('#projectHistoryTable tbody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            State.projects.slice(0, 10).forEach(project => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${escapeHtml(project.name)}</td>
                    <td>${escapeHtml(project.category)}</td>
                    <td>${escapeHtml(project.budget)}</td>
                    <td><span class="badge ${project.status === 'live' ? 'live' : project.status === 'in progress' ? 'pending' : 'completed'}">${escapeHtml(project.status)}</span></td>
                    <td>${new Date(project.createdAt).toLocaleDateString()}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Settings functionality
        function saveSettings() {
            State.settings.adminName = document.getElementById('adminName').value.trim();
            State.settings.adminEmail = document.getElementById('adminEmail').value.trim();
            State.settings.adminWork = document.getElementById('adminWork').value.trim();
            State.settings.adminPhone = document.getElementById('adminPhone').value.trim();
            State.settings.adminBio = document.getElementById('adminBio').value.trim();
            saveState();
            showNotification('Settings saved successfully!');
        }

        function changeProfileImage() {
            // In a real application, this would open a file picker
            const newImage = prompt('Enter new profile image URL:');
            if (newImage) {
                State.settings.adminImage = newImage;
                document.getElementById('adminProfileImage').src = newImage;
                saveState();
                showNotification('Profile image updated!');
            }
        }

        function resetAllData() {
            if (confirm('Are you sure you want to reset all data? This cannot be undone.')) {
                State = JSON.parse(JSON.stringify(defaultSeed));
                saveState();
                location.reload();
            }
        }

        // Refer code functionality
        function setReferDisplay() {
            document.getElementById('adminRefer').innerText = State.adminRefer || '—';
            document.getElementById('managerRefer').innerText = State.managerRefer || '—';
        }

        function copyReferCode(kind, btn) {
            const code = kind === 'admin' ? State.adminRefer : State.managerRefer;
            if (!code) return alert('No code yet');
            
            navigator.clipboard?.writeText(code).then(() => {
                if (btn) {
                    const original = btn.innerHTML;
                    btn.classList.add('copied');
                    btn.innerHTML = '<i class="fas fa-check"></i> Copied!';
                    setTimeout(() => {
                        btn.classList.remove('copied');
                        btn.innerHTML = original;
                    }, 1400);
                }
            }).catch(() => {
                prompt('Copy this code', code);
            });
        }

        function regenUI(kind) {
            if (kind === 'admin') {
                State.adminRefer = 'ADM' + Math.floor(Math.random() * 90000 + 10000);
            } else {
                State.managerRefer = 'MNG' + Math.floor(Math.random() * 90000 + 10000);
            }
            saveState();
            setReferDisplay();
            
            const elId = kind === 'admin' ? '#adminRefer' : '#managerRefer';
            const node = document.querySelector(elId);
            node.style.boxShadow = '0 8px 40px rgba(0,212,255,0.08)';
            setTimeout(() => node.style.boxShadow = '', 900);
            
            showNotification(`${kind} refer code regenerated!`);
        }

        function simulateSignupFromRefer() {
            const name = prompt('New user name (demo)');
            const email = prompt('New user email (demo)');
            const type = prompt('Account type (Admin or Manager)').trim();
            if (!name || !email || !type) {
                alert('Cancelled');
                return;
            }
            
            const code = (type.toLowerCase() === 'admin') ? State.adminRefer : State.managerRefer;
            const id = State.referUsage.length ? Math.max(...State.referUsage.map(r => r.id)) + 1 : 1;
            const when = new Date().toISOString();
            State.referUsage.unshift({id, when, user: name, email, code, type});
            
            const newId = State.members.length ? Math.max(...State.members.map(m => m.id)) + 1 : 1;
            State.members.unshift({
                id: newId,
                avatar: `https://i.pravatar.cc/80?u=${encodeURIComponent(email)}`,
                name,
                email,
                status: 'active',
                role: type.toLowerCase() === 'admin' ? 'admin' : 'member',
                specialization: type.toLowerCase() === 'admin' ? 'Administration' : 'General',
                phone: '+1 234 567 8900',
                bio: 'New member',
                joinDate: new Date().toISOString().split('T')[0],
                password: 'password123',
                paymentMethod: 'PayPal',
                paymentAddress: `${email}`,
                ipAddress: `192.168.1.${Math.floor(Math.random() * 100) + 100}`,
                dashboardAccess: [type.toLowerCase() === 'admin' ? 'admin' : 'member'],
                earnings: 0,
                projectsCompleted: 0,
                workHistory: []
            });
            
            // Add activity
            State.activities.unshift({
                id: State.activities.length ? Math.max(...State.activities.map(a => a.id)) + 1 : 1,
                when: new Date().toISOString(),
                text: `${name} registered using ${code} code`,
                type: 'signup'
            });
            
            saveState();
            updateLiveMemberCount();
            showNotification(`${name} registered with code ${code}`);
        }

        // Modal functionality
        let currentModal = null;
        let currentEditingId = null;

        function openModal(kind, payload = null) {
            currentModal = kind;
            currentEditingId = payload ? payload.id : null;
            const modalBody = document.getElementById('modalBody');
            const modalTitle = document.getElementById('modalTitle');
            const modalPrimaryBtn = document.getElementById('modalPrimaryBtn');
            
            modalBody.innerHTML = '';
            modalTitle.innerHTML = (payload ? '<i class="fas fa-edit"></i> Edit ' : '<i class="fas fa-plus"></i> Add ') + (kind[0].toUpperCase() + kind.slice(1));

            if (kind === 'member') {
                modalBody.innerHTML = `
                    <div class="form-section">
                        <div class="form-section-title"><i class="fas fa-user"></i> Basic Information</div>
                        <div class="form-group">
                            <label class="form-label">Avatar URL</label>
                            <input class="form-input" id="fld_member_avatar" placeholder="Avatar URL" value="${payload ? escapeHtml(payload.avatar) : ''}">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Full Name</label>
                            <input class="form-input" id="fld_member_name" placeholder="Full name" value="${payload ? escapeHtml(payload.name) : ''}">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Email</label>
                            <input class="form-input" id="fld_member_email" placeholder="Email" value="${payload ? escapeHtml(payload.email) : ''}">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Phone</label>
                            <input class="form-input" id="fld_member_phone" placeholder="Phone" value="${payload ? escapeHtml(payload.phone) : ''}">
                        </div>
                    </div>
                    <div class="form-section">
                        <div class="form-section-title"><i class="fas fa-cog"></i> Account Settings</div>
                        <div class="form-group">
                            <label class="form-label">Password</label>
                            <input class="form-input" id="fld_member_password" placeholder="Login password" value="${payload ? escapeHtml(payload.password) : 'password123'}">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Specialization</label>
                            <select class="form-select" id="fld_member_specialization">
                                <option value="Web Developer">Web Developer</option>
                                <option value="Graphic Designer">Graphic Designer</option>
                                <option value="SEO Expert">SEO Expert</option>
                                <option value="Digital Marketer">Digital Marketer</option>
                                <option value="Content Writer">Content Writer</option>
                                <option value="Project Manager">Project Manager</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Status</label>
                            <select class="form-select" id="fld_member_status">
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                                <option value="banned">Banned</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Role</label>
                            <select class="form-select" id="fld_member_role">
                                <option value="member">Member</option>
                                <option value="manager">Manager</option>
                                <option value="admin">Admin</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Dashboard Access</label>
                            <div>
                                <label><input type="checkbox" id="fld_member_access_member" ${payload && payload.dashboardAccess.includes('member') ? 'checked' : 'checked'}> Member Dashboard</label><br>
                                <label><input type="checkbox" id="fld_member_access_manager" ${payload && payload.dashboardAccess.includes('manager') ? 'checked' : ''}> Manager Dashboard</label>
                            </div>
                        </div>
                    </div>
                    <div class="form-section">
                        <div class="form-section-title"><i class="fas fa-money-bill-wave"></i> Payment Information</div>
                        <div class="form-group">
                            <label class="form-label">Payment Method</label>
                            <select class="form-select" id="fld_member_payment_method">
                                <option value="PayPal">PayPal</option>
                                <option value="Bank Transfer">Bank Transfer</option>
                                <option value="Stripe">Stripe</option>
                                <option value="Cash">Cash</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Payment Address</label>
                            <input class="form-input" id="fld_member_payment_address" placeholder="Payment receiving address" value="${payload ? escapeHtml(payload.paymentAddress) : ''}">
                        </div>
                    </div>
                `;
                if (payload) {
                    document.getElementById('fld_member_status').value = payload.status;
                    document.getElementById('fld_member_role').value = payload.role || 'member';
                    document.getElementById('fld_member_specialization').value = payload.specialization || 'Web Developer';
                    document.getElementById('fld_member_payment_method').value = payload.paymentMethod || 'PayPal';
                }
                modalPrimaryBtn.onclick = saveMemberFromModal;
            } else if (kind === 'manager') {
                modalBody.innerHTML = `
                    <div class="form-section">
                        <div class="form-section-title"><i class="fas fa-user-tie"></i> Basic Information</div>
                        <div class="form-group">
                            <label class="form-label">Avatar URL</label>
                            <input class="form-input" id="fld_manager_avatar" placeholder="Avatar URL" value="${payload ? escapeHtml(payload.avatar) : ''}">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Full Name</label>
                            <input class="form-input" id="fld_manager_name" placeholder="Full name" value="${payload ? escapeHtml(payload.name) : ''}">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Email</label>
                            <input class="form-input" id="fld_manager_email" placeholder="Email" value="${payload ? escapeHtml(payload.email) : ''}">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Phone</label>
                            <input class="form-input" id="fld_manager_phone" placeholder="Phone" value="${payload ? escapeHtml(payload.phone) : ''}">
                        </div>
                    </div>
                    <div class="form-section">
                        <div class="form-section-title"><i class="fas fa-cog"></i> Account Settings</div>
                        <div class="form-group">
                            <label class="form-label">Password</label>
                            <input class="form-input" id="fld_manager_password" placeholder="Login password" value="${payload ? escapeHtml(payload.password) : 'password123'}">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Specialization</label>
                            <select class="form-select" id="fld_manager_specialization">
                                <option value="Project Management">Project Management</option>
                                <option value="Team Lead">Team Lead</option>
                                <option value="Operations">Operations</option>
                                <option value="Quality Assurance">Quality Assurance</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Status</label>
                            <select class="form-select" id="fld_manager_status">
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Role</label>
                            <select class="form-select" id="fld_manager_role">
                                <option value="manager">Manager</option>
                                <option value="admin">Admin</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Dashboard Access</label>
                            <div>
                                <label><input type="checkbox" id="fld_manager_access_member" ${payload && payload.dashboardAccess.includes('member') ? 'checked' : ''}> Member Dashboard</label><br>
                                <label><input type="checkbox" id="fld_manager_access_manager" ${payload && payload.dashboardAccess.includes('manager') ? 'checked' : 'checked'}> Manager Dashboard</label>
                            </div>
                        </div>
                    </div>
                    <div class="form-section">
                        <div class="form-section-title"><i class="fas fa-money-bill-wave"></i> Payment Information</div>
                        <div class="form-group">
                            <label class="form-label">Payment Method</label>
                            <select class="form-select" id="fld_manager_payment_method">
                                <option value="PayPal">PayPal</option>
                                <option value="Bank Transfer">Bank Transfer</option>
                                <option value="Stripe">Stripe</option>
                                <option value="Cash">Cash</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Payment Address</label>
                            <input class="form-input" id="fld_manager_payment_address" placeholder="Payment receiving address" value="${payload ? escapeHtml(payload.paymentAddress) : ''}">
                        </div>
                    </div>
                `;
                if (payload) {
                    document.getElementById('fld_manager_status').value = payload.status;
                    document.getElementById('fld_manager_role').value = payload.role || 'manager';
                    document.getElementById('fld_manager_specialization').value = payload.specialization || 'Project Management';
                    document.getElementById('fld_manager_payment_method').value = payload.paymentMethod || 'PayPal';
                }
                modalPrimaryBtn.onclick = saveManagerFromModal;
            }

            document.getElementById('modalBackdrop').style.display = 'flex';
            document.getElementById('modalBackdrop').setAttribute('aria-hidden', 'false');
        }

        function closeModal() {
            document.getElementById('modalBackdrop').style.display = 'none';
            document.getElementById('modalBackdrop').setAttribute('aria-hidden', 'true');
            currentModal = null;
            currentEditingId = null;
        }

        function saveMemberFromModal() {
            const avatar = document.getElementById('fld_member_avatar').value.trim() || `https://i.pravatar.cc/80?u=${Date.now()}`;
            const name = document.getElementById('fld_member_name').value.trim();
            const email = document.getElementById('fld_member_email').value.trim();
            const phone = document.getElementById('fld_member_phone').value.trim();
            const password = document.getElementById('fld_member_password').value.trim();
            const specialization = document.getElementById('fld_member_specialization').value;
            const status = document.getElementById('fld_member_status').value;
            const role = document.getElementById('fld_member_role').value || 'member';
            const paymentMethod = document.getElementById('fld_member_payment_method').value;
            const paymentAddress = document.getElementById('fld_member_payment_address').value.trim();
            
            // Get dashboard access
            const dashboardAccess = [];
            if (document.getElementById('fld_member_access_member').checked) dashboardAccess.push('member');
            if (document.getElementById('fld_member_access_manager').checked) dashboardAccess.push('manager');
            
            if (!name || !email || !password) {
                alert('Name, email and password are required');
                return;
            }
            
            if (currentEditingId) {
                const m = State.members.find(x => x.id === currentEditingId);
                if (m) Object.assign(m, {avatar, name, email, phone, password, specialization, status, role, paymentMethod, paymentAddress, dashboardAccess});
            } else {
                const id = State.members.length ? Math.max(...State.members.map(x => x.id)) + 1 : 1;
                State.members.unshift({
                    id, avatar, name, email, phone, password, specialization, status, role, 
                    paymentMethod, paymentAddress, dashboardAccess,
                    bio: 'New member',
                    joinDate: new Date().toISOString().split('T')[0],
                    ipAddress: `192.168.1.${Math.floor(Math.random() * 100) + 100}`,
                    earnings: 0,
                    projectsCompleted: 0,
                    workHistory: []
                });
                
                // Add activity
                State.activities.unshift({
                    id: State.activities.length ? Math.max(...State.activities.map(a => a.id)) + 1 : 1,
                    when: new Date().toISOString(),
                    text: `${name} added as ${role}`,
                    type: 'signup'
                });
            }
            saveState();
            updateTables();
            updateStats();
            updateLiveMemberCount();
            closeModal();
            showNotification(`Member ${currentEditingId ? 'updated' : 'added'} successfully!`);
        }

        function saveManagerFromModal() {
            const avatar = document.getElementById('fld_manager_avatar').value.trim() || `https://i.pravatar.cc/80?u=${Date.now()}`;
            const name = document.getElementById('fld_manager_name').value.trim();
            const email = document.getElementById('fld_manager_email').value.trim();
            const phone = document.getElementById('fld_manager_phone').value.trim();
            const password = document.getElementById('fld_manager_password').value.trim();
            const specialization = document.getElementById('fld_manager_specialization').value;
            const status = document.getElementById('fld_manager_status').value;
            const role = document.getElementById('fld_manager_role').value || 'manager';
            const paymentMethod = document.getElementById('fld_manager_payment_method').value;
            const paymentAddress = document.getElementById('fld_manager_payment_address').value.trim();
            
            // Get dashboard access
            const dashboardAccess = [];
            if (document.getElementById('fld_manager_access_member').checked) dashboardAccess.push('member');
            if (document.getElementById('fld_manager_access_manager').checked) dashboardAccess.push('manager');
            
            if (!name || !email || !password) {
                alert('Name, email and password are required');
                return;
            }
            
            if (currentEditingId) {
                const m = State.managers.find(x => x.id === currentEditingId);
                if (m) Object.assign(m, {avatar, name, email, phone, password, specialization, status, role, paymentMethod, paymentAddress, dashboardAccess});
            } else {
                const id = State.managers.length ? Math.max(...State.managers.map(x => x.id)) + 1 : 1;
                State.managers.unshift({
                    id, avatar, name, email, phone, password, specialization, status, role, 
                    paymentMethod, paymentAddress, dashboardAccess,
                    bio: 'New manager',
                    joinDate: new Date().toISOString().split('T')[0],
                    ipAddress: `192.168.1.${Math.floor(Math.random() * 100) + 200}`,
                    earnings: 0,
                    projectsCompleted: 0,
                    workHistory: []
                });
                
                // Add activity
                State.activities.unshift({
                    id: State.activities.length ? Math.max(...State.activities.map(a => a.id)) + 1 : 1,
                    when: new Date().toISOString(),
                    text: `${name} added as ${role}`,
                    type: 'signup'
                });
            }
            saveState();
            updateTables();
            updateStats();
            updateLiveManagerCount();
            closeModal();
            showNotification(`Manager ${currentEditingId ? 'updated' : 'added'} successfully!`);
        }

        function editMember(id) {
            const member = State.members.find(m => m.id === id);
            if (member) openModal('member', member);
        }

        function editManager(id) {
            const manager = State.managers.find(m => m.id === id);
            if (manager) openModal('manager', manager);
        }

        function deleteMember(id) {
            if (confirm('Are you sure you want to delete this member?')) {
                const member = State.members.find(m => m.id === id);
                if (member) {
                    // Add to deleted members
                    State.deletedMembers.unshift({
                        ...member,
                        deletedDate: new Date().toISOString()
                    });
                    
                    // Remove from members
                    State.members = State.members.filter(m => m.id !== id);
                    
                    // Add activity
                    State.activities.unshift({
                        id: State.activities.length ? Math.max(...State.activities.map(a => a.id)) + 1 : 1,
                        when: new Date().toISOString(),
                        text: `${member.name} deleted`,
                        type: 'delete'
                    });
                }
                saveState();
                updateTables();
                updateStats();
                updateLiveMemberCount();
                showNotification('Member deleted successfully!');
            }
        }

        function deleteManager(id) {
            if (confirm('Are you sure you want to delete this manager?')) {
                const manager = State.managers.find(m => m.id === id);
                if (manager) {
                    // Add to deleted members
                    State.deletedMembers.unshift({
                        ...manager,
                        deletedDate: new Date().toISOString()
                    });
                    
                    // Remove from managers
                    State.managers = State.managers.filter(m => m.id !== id);
                    
                    // Add activity
                    State.activities.unshift({
                        id: State.activities.length ? Math.max(...State.activities.map(a => a.id)) + 1 : 1,
                        when: new Date().toISOString(),
                        text: `${manager.name} deleted`,
                        type: 'delete'
                    });
                }
                saveState();
                updateTables();
                updateStats();
                updateLiveManagerCount();
                showNotification('Manager deleted successfully!');
            }
        }

        function promoteToManager(id) {
            const member = State.members.find(m => m.id === id);
            if (member) {
                // Remove from members
                State.members = State.members.filter(m => m.id !== id);
                
                // Add to managers
                const newId = State.managers.length ? Math.max(...State.managers.map(m => m.id)) + 1 : 1;
                State.managers.unshift({
                    ...member,
                    id: newId,
                    role: 'manager',
                    specialization: member.specialization || 'Project Management',
                    dashboardAccess: ['manager'],
                    earnings: member.earnings || 0,
                    projectsCompleted: member.projectsCompleted || 0,
                    workHistory: member.workHistory || []
                });
                
                // Add activity
                State.activities.unshift({
                    id: State.activities.length ? Math.max(...State.activities.map(a => a.id)) + 1 : 1,
                    when: new Date().toISOString(),
                    text: `${member.name} promoted to manager`,
                    type: 'promotion'
                });
                
                saveState();
                updateTables();
                updateLiveMemberCount();
                updateLiveManagerCount();
                showNotification(`${member.name} is now a manager!`);
            }
        }

        function demoteToMember(id) {
            const manager = State.managers.find(m => m.id === id);
            if (manager) {
                // Remove from managers
                State.managers = State.managers.filter(m => m.id !== id);
                
                // Add to members
                const newId = State.members.length ? Math.max(...State.members.map(m => m.id)) + 1 : 1;
                State.members.unshift({
                    ...manager,
                    id: newId,
                    role: 'member',
                    specialization: manager.specialization || 'General',
                    dashboardAccess: ['member'],
                    earnings: manager.earnings || 0,
                    projectsCompleted: manager.projectsCompleted || 0,
                    workHistory: manager.workHistory || []
                });
                
                // Add activity
                State.activities.unshift({
                    id: State.activities.length ? Math.max(...State.activities.map(a => a.id)) + 1 : 1,
                    when: new Date().toISOString(),
                    text: `${manager.name} demoted to member`,
                    type: 'demotion'
                });
                
                saveState();
                updateTables();
                updateLiveMemberCount();
                updateLiveManagerCount();
                showNotification(`${manager.name} is now a member!`);
            }
        }

        function viewProfile(type, id) {
            let profile;
            if (type === 'member') {
                profile = State.members.find(m => m.id === id);
            } else {
                profile = State.managers.find(m => m.id === id);
            }
            
            if (profile) {
                const modalBody = document.getElementById('viewModalBody');
                const modalTitle = document.getElementById('viewModalTitle');
                
                modalTitle.innerHTML = `<i class="fas fa-user"></i> ${profile.name} - Profile Details`;
                
                // Create work history table
                let workHistoryHTML = '';
                if (profile.workHistory && profile.workHistory.length > 0) {
                    workHistoryHTML = `
                        <table class="work-history-table">
                            <thead>
                                <tr>
                                    <th>Project Name</th>
                                    <th>Budget</th>
                                    <th>Accept Date</th>
                                    <th>Submission Date</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${profile.workHistory.map(work => `
                                    <tr>
                                        <td>${escapeHtml(work.projectName)}</td>
                                        <td>${escapeHtml(work.budget)}</td>
                                        <td>${escapeHtml(work.acceptDate)}</td>
                                        <td>${escapeHtml(work.submissionDate)}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    `;
                } else {
                    workHistoryHTML = '<p style="text-align: center; color: var(--muted); padding: 20px;">No work history available</p>';
                }
                
                modalBody.innerHTML = `
                    <div class="form-section">
                        <div class="form-section-title"><i class="fas fa-info-circle"></i> Basic Information</div>
                        <div style="display:flex;gap:20px;align-items:flex-start">
                            <div style="display:flex;flex-direction:column;align-items:center;gap:10px">
                                <div class="avatar" style="width:100px;height:100px;border-radius:50%;overflow:hidden">
                                    <img src="${profile.avatar}" alt="${profile.name}">
                                </div>
                                <span class="badge ${profile.status==='active' ? 'live' : profile.status==='banned' ? 'pending' : ''}">${profile.status}</span>
                            </div>
                            
                            <div style="flex:1;display:flex;flex-direction:column;gap:16px">
                                <div style="display:flex;gap:12px;flex-wrap:wrap">
                                    <div class="form-group" style="min-width:200px;flex:1">
                                        <label class="form-label">Name</label>
                                        <div class="form-input" style="background:rgba(255,255,255,0.02)">${escapeHtml(profile.name)}</div>
                                    </div>
                                    <div class="form-group" style="min-width:200px;flex:1">
                                        <label class="form-label">Email</label>
                                        <div class="form-input" style="background:rgba(255,255,255,0.02)">${escapeHtml(profile.email)}</div>
                                    </div>
                                </div>
                                
                                <div style="display:flex;gap:12px;flex-wrap:wrap">
                                    <div class="form-group" style="min-width:200px;flex:1">
                                        <label class="form-label">Phone</label>
                                        <div class="form-input" style="background:rgba(255,255,255,0.02)">${escapeHtml(profile.phone)}</div>
                                    </div>
                                    <div class="form-group" style="min-width:200px;flex:1">
                                        <label class="form-label">Role</label>
                                        <div class="form-input" style="background:rgba(255,255,255,0.02)">${escapeHtml(profile.role)}</div>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Specialization</label>
                                    <div class="form-input" style="background:rgba(255,255,255,0.02)">${escapeHtml(profile.specialization)}</div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Bio</label>
                                    <div class="form-textarea" style="background:rgba(255,255,255,0.02)">${escapeHtml(profile.bio)}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-section">
                        <div class="form-section-title"><i class="fas fa-cog"></i> Account Information</div>
                        <div style="display:flex;gap:12px;flex-wrap:wrap">
                            <div class="form-group" style="min-width:200px;flex:1">
                                <label class="form-label">Join Date</label>
                                <div class="form-input" style="background:rgba(255,255,255,0.02)">${escapeHtml(profile.joinDate)}</div>
                            </div>
                            <div class="form-group" style="min-width:200px;flex:1">
                                <label class="form-label">IP Address</label>
                                <div class="form-input" style="background:rgba(255,255,255,0.02)">${escapeHtml(profile.ipAddress)}</div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Dashboard Access</label>
                            <div class="form-input" style="background:rgba(255,255,255,0.02)">${profile.dashboardAccess.join(', ')}</div>
                        </div>
                    </div>
                    <div class="form-section">
                        <div class="form-section-title"><i class="fas fa-money-bill-wave"></i> Earnings & Projects</div>
                        <div style="display:flex;gap:12px;flex-wrap:wrap">
                            <div class="form-group" style="min-width:200px;flex:1">
                                <label class="form-label">Total Earnings</label>
                                <div class="form-input" style="background:rgba(255,255,255,0.02)">$${profile.earnings || 0}</div>
                            </div>
                            <div class="form-group" style="min-width:200px;flex:1">
                                <label class="form-label">Projects Completed</label>
                                <div class="form-input" style="background:rgba(255,255,255,0.02)">${profile.projectsCompleted || 0}</div>
                            </div>
                        </div>
                    </div>
                    <div class="form-section">
                        <div class="form-section-title"><i class="fas fa-history"></i> Work History</div>
                        <div class="form-group">
                            ${workHistoryHTML}
                        </div>
                    </div>
                    <div class="form-section">
                        <div class="form-section-title"><i class="fas fa-briefcase"></i> Portfolio Information</div>
                        <div class="form-group">
                            <label class="form-label">Portfolio</label>
                            <div class="form-textarea" style="background:rgba(255,255,255,0.02); height: 100px;">
                                ${profile.bio || 'No portfolio information available.'}
                            </div>
                        </div>
                    </div>
                    <div class="form-section">
                        <div class="form-section-title"><i class="fas fa-money-bill-wave"></i> Payment Information</div>
                        <div style="display:flex;gap:12px;flex-wrap:wrap">
                            <div class="form-group" style="min-width:200px;flex:1">
                                <label class="form-label">Payment Method</label>
                                <div class="form-input" style="background:rgba(255,255,255,0.02)">${escapeHtml(profile.paymentMethod)}</div>
                            </div>
                            <div class="form-group" style="min-width:200px;flex:1">
                                <label class="form-label">Payment Address</label>
                                <div class="form-input" style="background:rgba(255,255,255,0.02)">${escapeHtml(profile.paymentAddress)}</div>
                            </div>
                        </div>
                    </div>
                `;
                
                document.getElementById('viewModal').style.display = 'flex';
                document.getElementById('viewModal').setAttribute('aria-hidden', 'false');
            }
        }

        function closeViewModal() {
            document.getElementById('viewModal').style.display = 'none';
            document.getElementById('viewModal').setAttribute('aria-hidden', 'true');
        }

        function viewProject(id) {
            const project = State.projects.find(p => p.id === id);
            
            if (project) {
                const modalBody = document.getElementById('viewProjectModalBody');
                const modalTitle = document.getElementById('viewProjectModalTitle');
                
                modalTitle.innerHTML = `<i class="fas fa-project-diagram"></i> ${project.name} - Project Details`;
                
                modalBody.innerHTML = `
                    <div class="form-section">
                        <div class="form-section-title"><i class="fas fa-info-circle"></i> Basic Information</div>
                        <div style="display:flex;gap:12px;flex-wrap:wrap">
                            <div class="form-group" style="min-width:200px;flex:1">
                                <label class="form-label">Project Name</label>
                                <div class="form-input" style="background:rgba(255,255,255,0.02)">${escapeHtml(project.name)}</div>
                            </div>
                            <div class="form-group" style="min-width:200px;flex:1">
                                <label class="form-label">Category</label>
                                <div class="form-input" style="background:rgba(255,255,255,0.02)">${escapeHtml(project.category)}</div>
                            </div>
                        </div>
                        <div style="display:flex;gap:12px;flex-wrap:wrap">
                            <div class="form-group" style="min-width:200px;flex:1">
                                <label class="form-label">Budget</label>
                                <div class="form-input" style="background:rgba(255,255,255,0.02)">${escapeHtml(project.budget)}</div>
                            </div>
                            <div class="form-group" style="min-width:200px;flex:1">
                                <label class="form-label">Deadline</label>
                                <div class="form-input" style="background:rgba(255,255,255,0.02)">${escapeHtml(project.deadline)}</div>
                            </div>
                        </div>
                        <div style="display:flex;gap:12px;flex-wrap:wrap">
                            <div class="form-group" style="min-width:200px;flex:1">
                                <label class="form-label">Priority</label>
                                <div class="form-input" style="background:rgba(255,255,255,0.02)">${escapeHtml(project.priority)}</div>
                            </div>
                            <div class="form-group" style="min-width:200px;flex:1">
                                <label class="form-label">Status</label>
                                <div class="form-input" style="background:rgba(255,255,255,0.02)"><span class="badge ${project.status==='live' ? 'live' : project.status==='in progress' ? 'pending' : 'completed'}">${escapeHtml(project.status)}</span></div>
                            </div>
                        </div>
                        <div style="display:flex;gap:12px;flex-wrap:wrap">
                            <div class="form-group" style="min-width:200px;flex:1">
                                <label class="form-label">Accepted By</label>
                                <div class="form-input" style="background:rgba(255,255,255,0.02)">${escapeHtml(project.accepted || 'Not accepted yet')}</div>
                            </div>
                            <div class="form-group" style="min-width:200px;flex:1">
                                <label class="form-label">Completed By</label>
                                <div class="form-input" style="background:rgba(255,255,255,0.02)">${escapeHtml(project.completed || 'Not completed yet')}</div>
                            </div>
                        </div>
                    </div>
                    <div class="form-section">
                        <div class="form-section-title"><i class="fas fa-align-left"></i> Description</div>
                        <div class="form-group">
                            <div class="form-textarea" style="background:rgba(255,255,255,0.02); height: auto;">${escapeHtml(project.description)}</div>
                        </div>
                    </div>
                    <div class="form-section">
                        <div class="form-section-title"><i class="fas fa-tasks"></i> Requirements</div>
                        <div class="form-group">
                            <div class="form-textarea" style="background:rgba(255,255,255,0.02); height: auto;">${escapeHtml(project.requirements)}</div>
                        </div>
                    </div>
                `;
                
                document.getElementById('viewProjectModal').style.display = 'flex';
                document.getElementById('viewProjectModal').setAttribute('aria-hidden', 'false');
            }
        }

        function closeViewProjectModal() {
            document.getElementById('viewProjectModal').style.display = 'none';
            document.getElementById('viewProjectModal').setAttribute('aria-hidden', 'true');
        }

        function updatePaymentStatus(id, status) {
            const payment = State.payments.find(p => p.id === id);
            if (payment) {
                payment.status = status;
                
                // Add activity
                State.activities.unshift({
                    id: State.activities.length ? Math.max(...State.activities.map(a => a.id)) + 1 : 1,
                    when: new Date().toISOString(),
                    text: `Payment status updated for ${payment.member} to ${status}`,
                    type: 'payment'
                });
                
                saveState();
                updateStats();
                showNotification(`Payment status updated to ${status}`);
            }
        }

        function blockIP(ip, email) {
            if (confirm(`Are you sure you want to block IP ${ip} and email ${email}?`)) {
                if (!State.blockedIPs.includes(ip)) {
                    State.blockedIPs.push(ip);
                    
                    // Add activity
                    State.activities.unshift({
                        id: State.activities.length ? Math.max(...State.activities.map(a => a.id)) + 1 : 1,
                        when: new Date().toISOString(),
                        text: `IP ${ip} and email ${email} blocked`,
                        type: 'block'
                    });
                    
                    saveState();
                    updateTables();
                    showNotification(`IP ${ip} and email ${email} blocked successfully!`);
                } else {
                    showNotification('This IP is already blocked!');
                }
            }
        }

        function unblockIP(ip, email) {
            if (confirm(`Are you sure you want to unblock IP ${ip} and email ${email}?`)) {
                State.blockedIPs = State.blockedIPs.filter(blockedIP => blockedIP !== ip);
                
                // Remove from deleted members if they re-register
                State.deletedMembers = State.deletedMembers.filter(member => member.ipAddress !== ip);
                
                // Add activity
                State.activities.unshift({
                    id: State.activities.length ? Math.max(...State.activities.map(a => a.id)) + 1 : 1,
                    when: new Date().toISOString(),
                    text: `IP ${ip} and email ${email} unblocked`,
                    type: 'unblock'
                });
                
                saveState();
                updateTables();
                showNotification(`IP ${ip} and email ${email} unblocked successfully!`);
            }
        }

        // Table search functionality
        function tableSearch(event) {
            const searchTerm = event.target.value.toLowerCase();
            const tableId = event.target.getAttribute('data-table');
            const rows = document.querySelectorAll(`#${tableId} tbody tr`);
            
            rows.forEach(row => {
                let found = false;
                for (let i = 0; i < row.cells.length; i++) {
                    const cellText = row.cells[i].textContent.toLowerCase();
                    if (cellText.includes(searchTerm)) {
                        found = true;
                        break;
                    }
                }
                row.style.display = found ? '' : 'none';
            });
        }

        // Table filter functionality
        function applyTableFilter(tableId, column, value) {
            const rows = document.querySelectorAll(`#${tableId} tbody tr`);
            
            rows.forEach(row => {
                let showRow = true;
                if (value) {
                    const cellText = row.querySelector(`td:nth-child(${getColumnIndex(tableId, column)})`).textContent.toLowerCase();
                    if (!cellText.includes(value.toLowerCase())) {
                        showRow = false;
                    }
                }
                row.style.display = showRow ? '' : 'none';
            });
        }

        // Helper function to get column index
        function getColumnIndex(tableId, columnName) {
            const headers = document.querySelectorAll(`#${tableId} thead th`);
            for (let i = 0; i < headers.length; i++) {
                if (headers[i].getAttribute('data-col') === columnName) {
                    return i + 1;
                }
            }
            return -1;
        }

        // Initialize the dashboard
        function initDashboard() {
            // Set up initial UI state
            document.getElementById('adminName').value = State.settings.adminName;
            document.getElementById('adminEmail').value = State.settings.adminEmail;
            document.getElementById('adminWork').value = State.settings.adminWork;
            document.getElementById('adminPhone').value = State.settings.adminPhone;
            document.getElementById('adminBio').value = State.settings.adminBio;
            document.getElementById('adminProfileImage').src = State.settings.adminImage;
            
            // Update stats
            updateStats();
            
            // Update tables
            updateTables();
            
            // Update project history
            updateProjectHistory();
            
            // Update live counts
            updateLiveMemberCount();
            updateLiveManagerCount();
            
            // Render activity table
            renderActivityTable();
            
            // Set up card animations
            document.querySelectorAll('.card').forEach((card, i) => {
                setTimeout(() => card.classList.add('show'), i * 120);
            });
            
            // Set refer codes display
            setReferDisplay();
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', (e) => {
            const dropdown = document.getElementById('profileDropdown');
            const switcher = document.querySelector('.profile-switcher');
            if (!switcher.contains(e.target) && dropdown.classList.contains('show')) {
                dropdown.classList.remove('show');
            }
            
            // Close modals when clicking on backdrop
            const modal = document.getElementById('modalBackdrop');
            if (e.target === modal) {
                closeModal();
            }
            
            const viewModal = document.getElementById('viewModal');
            if (e.target === viewModal) {
                closeViewModal();
            }
            
            const viewProjectModal = document.getElementById('viewProjectModal');
            if (e.target === viewProjectModal) {
                closeViewProjectModal();
            }
        });

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', initDashboard);
    </script>
</body>
</html>